<!DOCTYPE html>
<html lang="zh-tw">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='https://lyccyc.github.io/penguin.cyc/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://lyccyc.github.io/penguin.cyc/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://lyccyc.github.io/penguin.cyc/css/github.min.css' />
    <link rel="stylesheet" href='https://lyccyc.github.io/penguin.cyc/css/github-style.css' />
    <link rel="stylesheet" href='https://lyccyc.github.io/penguin.cyc/css/light.css' />
    <link rel="stylesheet" href='https://lyccyc.github.io/penguin.cyc/css/dark.css' />
    <link rel="stylesheet" href='https://lyccyc.github.io/penguin.cyc/css/syntax.css' />
    <title>2025_islabCTF_writeups - Penguin&#39;s blog</title>
    
    <link rel="icon" type="image/x-icon" href='../../images/favicon.ico'>
    
    <meta name="theme-color" content="#1e2327">

    <link rel="stylesheet" href="https://lyccyc.github.io/penguin.cyc/css/self.css">
    

    
    <meta name="description"
  content="2025_islabCTF_writeups èº«ç‚ºåŒ—ç§‘ islab Web ç‹—çš„æˆå“¡ä¹‹ä¸€ï¼Œé€™æ¬¡æ¯”è³½å¿…é ˆåƒåŠ çš„å§
ä½†æ˜¯æ²’äººè·Ÿæˆ‘èªªå¾Œé¢æœƒæœ‰é€™éº¼å¤šè³½æ£é€²ä¾†é˜¿å–‚ï¼Œå¥½å•¦æ‰£æ‰ä»–å€‘çš„è©±ï¼Œé€™æ¬¡æ‡‰è©²æ˜¯ç¬¬å››å(è‡ªæˆ‘å®‰æ…°
é€™æ¬¡å…±è§£äº†12é¡Œ
Misc 1 é¡Œï¼ŒForensics 1 é¡Œï¼ŒOSINT 3 é¡Œï¼ŒCrypto 1 é¡Œï¼ŒReverse 3 é¡Œï¼ŒWeb 3 é¡Œ
" />
<meta name="keywords"
  content='' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://lyccyc.github.io/penguin.cyc/post/2025_islabctf_writeups/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="2025_islabCTF_writeups - Penguin&#39;s blog" />
<meta name="twitter:description"
  content="2025_islabCTF_writeups èº«ç‚ºåŒ—ç§‘ islab Web ç‹—çš„æˆå“¡ä¹‹ä¸€ï¼Œé€™æ¬¡æ¯”è³½å¿…é ˆåƒåŠ çš„å§
ä½†æ˜¯æ²’äººè·Ÿæˆ‘èªªå¾Œé¢æœƒæœ‰é€™éº¼å¤šè³½æ£é€²ä¾†é˜¿å–‚ï¼Œå¥½å•¦æ‰£æ‰ä»–å€‘çš„è©±ï¼Œé€™æ¬¡æ‡‰è©²æ˜¯ç¬¬å››å(è‡ªæˆ‘å®‰æ…°
é€™æ¬¡å…±è§£äº†12é¡Œ
Misc 1 é¡Œï¼ŒForensics 1 é¡Œï¼ŒOSINT 3 é¡Œï¼ŒCrypto 1 é¡Œï¼ŒReverse 3 é¡Œï¼ŒWeb 3 é¡Œ
" />
<meta name="twitter:site" content="https://lyccyc.github.io/penguin.cyc/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image"
  content="https://lyccyc.github.io/penguin.cyc/">


<meta property="og:type" content="article" />
<meta property="og:title" content="2025_islabCTF_writeups - Penguin&#39;s blog">
<meta property="og:description"
  content="2025_islabCTF_writeups èº«ç‚ºåŒ—ç§‘ islab Web ç‹—çš„æˆå“¡ä¹‹ä¸€ï¼Œé€™æ¬¡æ¯”è³½å¿…é ˆåƒåŠ çš„å§
ä½†æ˜¯æ²’äººè·Ÿæˆ‘èªªå¾Œé¢æœƒæœ‰é€™éº¼å¤šè³½æ£é€²ä¾†é˜¿å–‚ï¼Œå¥½å•¦æ‰£æ‰ä»–å€‘çš„è©±ï¼Œé€™æ¬¡æ‡‰è©²æ˜¯ç¬¬å››å(è‡ªæˆ‘å®‰æ…°
é€™æ¬¡å…±è§£äº†12é¡Œ
Misc 1 é¡Œï¼ŒForensics 1 é¡Œï¼ŒOSINT 3 é¡Œï¼ŒCrypto 1 é¡Œï¼ŒReverse 3 é¡Œï¼ŒWeb 3 é¡Œ
" />
<meta property="og:url" content="https://lyccyc.github.io/penguin.cyc/post/2025_islabctf_writeups/" />
<meta property="og:site_name" content="2025_islabCTF_writeups" />
<meta property="og:image"
  content="https://lyccyc.github.io/penguin.cyc/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2025-09-22 19:17:07 &#43;0800 CST" />











</head>


<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://lyccyc.github.io/penguin.cyc/">
        <img class="octicon" height="32" width="32" src="">
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd" d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          
          <form target="_blank" action="https://www.google.com/search" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
              <input type="hidden" name="q" value="site:https://lyccyc.github.io/penguin.cyc/">
            </label>
          </form>
          
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="https://lyccyc.github.io/penguin.cyc/">
        <img class="octicon octicon-mark-github v-align-middle" height="32" width="32" src="">
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>

  <div id="search-result" class="container-lg px-3 new-discussion-timeline" style="display: none;">
</div>

  
<div class="application-main">
  <div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://lyccyc.github.io/penguin.cyc/">
                  <img class=" avatar-user"
                    src="../../images/penguin.png"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://lyccyc.github.io/penguin.cyc/">é™³æ˜±è‡»(ä¼éµ)</a>
                  </span>
                  <span class="path-divider">/</span>
                  <strong class="css-truncate css-truncate-target mr-1" style="max-width: 410px">
                    <a href="https://lyccyc.github.io/penguin.cyc/post/2025_islabctf_writeups/">2025_islabCTF_writeups</a>
                  </strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Mon, 22 Sep 2025 19:17:07 &#43;0800"
                    class="no-wrap">
                    Mon, 22 Sep 2025 19:17:07 &#43;0800</relative-time>

                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style="z-index: 2">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" onclick="clickToc()" class="btn btn-octicon m-0 mr-2 p-2">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                    <details-menu class="SelectMenu" id="toc-details" style="display: none;">
                      <div class="SelectMenu-modal rounded-3 mt-1" style="max-height: 340px;">
                        <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" id="toc-list">
                        </div>
                      </div>
                    </details-menu>
                      9640 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                    
                    <a class="muted-link mr-3" href="../../tags/ctf">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      CTF
                    </a>
                    
                    <a class="muted-link mr-3" href="../../tags/islab">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      islab
                    </a>
                    
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5" style="z-index: 1">
                <article class="markdown-body entry-content container-lg"><h1 id="2025_islabctf_writeups">2025_islabCTF_writeups</h1>
<p>èº«ç‚ºåŒ—ç§‘ islab Web ç‹—çš„æˆå“¡ä¹‹ä¸€ï¼Œé€™æ¬¡æ¯”è³½å¿…é ˆåƒåŠ çš„å§</p>
<p>ä½†æ˜¯æ²’äººè·Ÿæˆ‘èªªå¾Œé¢æœƒæœ‰é€™éº¼å¤šè³½æ£é€²ä¾†é˜¿å–‚ï¼Œå¥½å•¦æ‰£æ‰ä»–å€‘çš„è©±ï¼Œé€™æ¬¡æ‡‰è©²æ˜¯ç¬¬å››å(è‡ªæˆ‘å®‰æ…°</p>
<p>é€™æ¬¡å…±è§£äº†12é¡Œ</p>
<p>Misc 1 é¡Œï¼ŒForensics 1 é¡Œï¼ŒOSINT 3 é¡Œï¼ŒCrypto 1 é¡Œï¼ŒReverse 3 é¡Œï¼ŒWeb 3 é¡Œ</p>
<p><img src="../../images/2025_islab_penguin.png" alt="image"></p>
<p>(æ‰“åˆ°é€™è£¡çªç„¶ä¸æƒ³å¯« writeups äº†QQ)</p>
<p>ä½†æˆ‘å°±è³¤ï¼Œæ‰€ä»¥ç¹¼çºŒï¼Œå…ˆå¾ç°¡å–®çš„é–‹å§‹</p>
<h2 id="misc">Misc</h2>
<h3 id="welcome">Welcome</h3>
<p><img src="../../images/2025_islab_welcome.png" alt="image"></p>
<p>é»é–‹é€£çµæ˜¯é€™æ¬¡æ–°ç”Ÿç›ƒçš„ DC ä¼ºæœå™¨ï¼Œå•¥ä¹Ÿæ²’æœ‰</p>
<p>å¾Œä¾†å»é»æ¯å€‹é »é“ï¼Œç™¼ç¾åœ¨ 2025 æ–°ç”Ÿç›ƒ CTF çš„ discuss å°±æœ‰ flag äº†</p>
<div class="flag-box">
<strong>
flag : is1abCTF{r3ad_rul3_and_jo1n_di5c0rd_i5_4wes0me}
</strong>
</div>
<h2 id="forensics">Forensics</h2>
<h3 id="file-stealer">File Stealer</h3>
<p><img src="../../images/2025_islab_File-Stealer.png" alt="image"></p>
<p>ä¸‹è¼‰æª”æ¡ˆå¾Œæ˜¯ä¸€å€‹ .img æª”(ç£ç¢Ÿé¡åƒ)ï¼Œç”¨ windows æ‰“ä¸é–‹æ‰€ä»¥è½‰æˆ° kali</p>
<p>é»å…©ä¸‹ .img æª”æ›è¼‰å¾Œçœ‹åˆ°ä¸€å€‹ readme.txt çš„æª”æ¡ˆï¼Œå…§å®¹æ˜¯:</p>
<p>Public area. Nothing interesting here.
But you might need this later: &lsquo;is1ab&rsquo;.</p>
<p>hmmmï¼Œä¸å¤ªç†è§£ï¼Œåªå¥½å…ˆç”¨ file æŸ¥çœ‹æª”æ¡ˆæ ¼å¼</p>
<pre tabindex="0"><code>â”Œâ”€â”€(kaliã‰¿kali)-[~/isLab/2025_CTF/Forensics]
â””â”€$ fdisk -l file_stealer.img
Disk file_stealer.img: 64 MiB, 67108864 bytes, 131072 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x50f5b986

Device            Boot Start    End Sectors Size Id Type
file_stealer.img1       2048  67583   65536  32M  e W95 FAT16 (LBA)
file_stealer.img2      67584 129023   61440  30M 1e Hidden W95 FAT16 (LBA)
</code></pre><p>å†ç”¨ fdisk æª¢æŸ¥åˆ†å‰²è³‡è¨Š</p>
<pre tabindex="0"><code>â”Œâ”€â”€(kaliã‰¿kali)-[~/isLab/2025_CTF/Forensics]
â””â”€$ fdisk -l file_stealer.img
Disk file_stealer.img: 64 MiB, 67108864 bytes, 131072 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x50f5b986

Device            Boot Start    End Sectors Size Id Type
file_stealer.img1       2048  67583   65536  32M  e W95 FAT16 (LBA)
file_stealer.img2      67584 129023   61440  30M 1e Hidden W95 FAT16 (LBA)
</code></pre><p>å¯ä»¥ç™¼ç¾æœ‰å…©å€‹ FAT16 åˆ†å€:</p>
<ol>
<li>Partition 1 (32MB) â†’ æœ‰ readme.txt</li>
<li>Partition 2 (30MB, Hidden FAT16) â†’ éš±è—åˆ†å€ï¼Œæ‡‰è©²è—æœ‰çœŸæ­£çš„å…§å®¹</li>
</ol>
<p>æ¥ä¸‹ä¾†å»è¨ˆç®—å®ƒçš„ offsetï¼Œç„¶å¾Œå»æ›è¼‰éš±è—èµ·ä¾†çš„åˆ†å€</p>
<p><code>sudo mount -o ro,loop,offset=34603008 file_stealer.img /mnt/hidden</code></p>
<p>34603008 çš„ç”±ä¾†æ˜¯å› ç‚º file_stealer.img2 çš„èµ·å§‹ sector æ˜¯ 67584ï¼ŒåŠ ä¸Šæ¯å€‹ sector å¤§å° = 512 bytesï¼Œè€Œ mount çš„ offset åƒæ•¸ç‚º byte offsetï¼Œæ‰€ä»¥æœ€å¾Œ 67584 * 512 = 34603008</p>
<p>æ¥è‘—åœ¨éš±è—åˆ†å€ä¸­ç™¼ç¾ä¸€å€‹åç‚º DCIM_0001.TGZ çš„å£“ç¸®æª”ï¼Œè€æ¨£å­å…ˆå»è§£å£“ç¸®</p>
<p><code>tar -xzvf DCIM_0001.TGZ</code></p>
<p>å¾—åˆ°ä¸€å€‹ <code>doc.txt</code> ï¼Œé»é–‹å°±æ˜¯ flag äº†</p>
<div class="flag-box">
<strong>
flag : is1abCTF{h1dd3n_p4rt1t10n_1s_4w3s0m3}
</strong>
</div>
<h2 id="osint">OSINT</h2>
<blockquote>
<p>èº«ç‚º OSINT å°ˆå®¶ç«Ÿç„¶æœ‰ä¸€é¡Œæ²’è§£å‡ºä¾†ï¼Œåœ¨æ­¤å‘é»ƒå»·ç¿°å­¸é•·é“æ­‰ï¼Œä¸‹æ¬¡æˆ‘æœƒèªçœŸè½ä»–å ±å‘ŠQQ</p></blockquote>
<h3 id="i-love-free-music">I love free music</h3>
<p><img src="../../images/2025_islab_I-love-free-music.png" alt="2025_islab_I-love-free-music"></p>
<p>é»é–‹é¡Œç›®çµ¦çš„æª”æ¡ˆæ˜¯ä¸€å¼µåœ–ç‰‡
<img src="../../images/photo.jpg" alt="image"></p>
<p>åŸæœ¬æœè‘—æ—é‚Šé‚£æ£Ÿçœ‹èµ·ä¾†æœ‰é»ç‰¹è‰²çš„å»ºç¯‰æ‰¾ï¼Œä½†å‡ºç¾çš„ç«Ÿç„¶æ˜¯ç”šéº¼æ—¥æœ¬é£¯åº—???</p>
<p>çªç„¶éˆå…‰ä¸€é–ƒï¼Œçœ‹åˆ°å³ä¸‹è§’æœ‰ä¸€å€‹ ã€Œç¹”ã€ å­—ï¼Œé¦¬ä¸Šè½‰æˆ°</p>
<p>æ‰¾åˆ°ä¸€å€‹å¾ˆæ˜é¡¯çš„æ´»å‹•å«ã€Œç¹”â€§åºœä¸­ â€” 2025 æ–°åŒ—æ°¸çºŒé¢¨æ ¼æ—¥ã€ï¼Œæ‰¾äº†ä¸€ä¸‹ç¯€ç›®è¡¨</p>
<p><img src="../../images/2025_islab_I-love-free-music-1.png" alt="image"></p>
<p>é¡Œç›®æœ‰èªªæ˜¯æ¨‚åœ˜åè½‰æˆ md5ï¼ŒåŠ ä¸Šçœ‹åœ–ç‰‡å¤©è‰²æ‡‰è©²æ˜¯å‚æ™šï¼Œæ‰€ä»¥çŒœæ˜¯å®‹å¾³é¶´</p>
<p>å» <a href="https://www.md5hashgenerator.com/">md5 è½‰æ›ç¶²ç«™</a></p>
<div class="flag-box">
<strong>
flag : islab{b92cc093c2e25b3a8a1fd4cd1dfc542c}
</strong>
</div>
<h3 id="information-security">Information Security</h3>
<blockquote>
<p>é€™é¡Œ second bloodï¼Œå‘€å‘¼</p></blockquote>
<p><img src="../../images/2025_islab_Information-Security.png" alt="image"></p>
<p>é»é–‹é¡Œç›®çµ¦çš„æª”æ¡ˆæ˜¯ä¸€å¼µåœ–ç‰‡</p>
<p><img src="../../images/profile_pic.jpg" alt="profile_pic"></p>
<p>é¡Œç›®èªª rokku_888_ åœ¨å¤šå€‹ç¤¾ç¾¤å¹³å°ä¸Šçš†æœ‰æ´»èºç´€éŒ„ï¼Œéƒ½æç¤ºæˆé€™æ¨£äº†ç•¶ç„¶æ˜¯å¾ IG æ‰¾é˜¿(x</p>
<p><img src="../../images/2025_islab_Information-Security-IG.png" alt="image"></p>
<p>å®œé´»å­¸é•·å¾ˆæŠ±æ­‰ä»¥é€™æ¨£çš„æ–¹å¼åˆæ¬¡èªè­˜ä½ ï¼Œä½†é¡Œç›®å¥½ç©ï¼Œè®š</p>
<p>å»å·çªºä»–çš„ç²¾é¸é™å‹•ï¼Œç™¼ç¾æœ‰ä¸€å¼µ iPAS è³‡å®‰å·¥ç¨‹å¸«ä¸­ç´šè­‰ç…§</p>
<p>OSINT åˆ¥äºº20å¹´(?ï¼Œç›´è¦ºé‚£è£¡ä¸€å®šæœ‰æ±è¥¿(å…¶å¯¦æˆ‘åªæ˜¯æƒ³å·çªºä»–çš„èº«åˆ†è­‰å­—è™Ÿ</p>
<p>é–‹å•Ÿç¾åœ–ç§€ç§€ï¼Œæ›å…‰ã€äº®åº¦æ‹‰å¥½æ‹‰æ»¿</p>
<div class="flag-box">
<strong>
flag : islabCTF{1_R3d_So_Brav3}
</strong>
</div>
<h3 id="feedback">Feedback</h3>
<p>å°±å¡«å•å·ï¼Œä½†æˆ‘å¿˜è¨˜å­˜ flag äº†ï¼ŒæŠ±æ­‰æ–°æ‰‹å°ç™½æ²’ç¶“é©—ï¼Œä¸‹æ¬¡æœƒè¨˜å¾—</p>
<p><img src="../../images/2025_islab_Feedback.png" alt="image"></p>
<p>åœ–ç‰‡è­‰æ˜æˆ‘æœ‰å¡«</p>
<h2 id="crypto">Crypto</h2>
<blockquote>
<p>Crypto ä¾èˆŠæƒ³ cry</p></blockquote>
<h3 id="mitm">MITM</h3>
<blockquote>
<p>é€™é¡Œ third blood</p></blockquote>
<details close><summary>server(2).py ç¨‹å¼ç¢¼</summary>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env python3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">socket</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">threading</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hashlib</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">secrets</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Util.Padding</span> <span class="kn">import</span> <span class="n">pad</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Random</span> <span class="kn">import</span> <span class="n">get_random_bytes</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># --- Server Settings ---</span>
</span></span><span class="line"><span class="cl"><span class="n">HOST</span> <span class="o">=</span> <span class="s1">&#39;0.0.0.0&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">PORT</span> <span class="o">=</span> <span class="mi">1337</span>
</span></span><span class="line"><span class="cl"><span class="n">FLAG_FILE</span> <span class="o">=</span> <span class="s1">&#39;flag.txt&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_flag</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">FLAG_FILE</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;flag</span><span class="si">{file_not_found_on_server}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">FLAG_FILE</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">handle_connection</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">addr</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;[+] New connection from </span><span class="si">{</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, for which a separate thread has been created.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># --- Beginning of eavesdropping scenario ---</span>
</span></span><span class="line"><span class="cl">        <span class="n">conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;----- MITM Attack Initialized. Intercepting encrypted channel -----</span><span class="se">\n\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># --- 1. Diffie-Hellman parameters ---</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span> <span class="o">=</span> <span class="mi">155214169224186174245759019817233758959712483609876556421679567759735878173206273314271380424223420051598278563855517852997101246947883176353747918435174813511975576536353646684036755728974423538143090186411163821396091652013002565116673426504500657692938270440503451481091007910872038288051399770068237950977</span>
</span></span><span class="line"><span class="cl">        <span class="n">g</span> <span class="o">=</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># --- 2. Initial Handshake ---</span>
</span></span><span class="line"><span class="cl">        <span class="n">conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;Alice: Hello Bob, initiating secure channel.</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;Bob: Hello Alice, I am ready.</span><span class="se">\n\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># --- 3. Key Exchange ---</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Alice generates private key a and calculates public key A</span>
</span></span><span class="line"><span class="cl">        <span class="n">alice_private_key</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">randbelow</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">101</span><span class="p">)</span> <span class="o">+</span> <span class="mi">100</span> <span class="c1"># Ensure a &gt;= 100</span>
</span></span><span class="line"><span class="cl">        <span class="n">alice_public_key</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">alice_private_key</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Alice -&gt; Bob (Public Key): </span><span class="si">{</span><span class="n">alice_public_key</span><span class="si">}</span><span class="se">\n</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Bob generates private key b and calculates public key B</span>
</span></span><span class="line"><span class="cl">        <span class="n">bob_private_key</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">randbelow</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">101</span><span class="p">)</span> <span class="o">+</span> <span class="mi">100</span> <span class="c1"># Ensure b &gt;= 100</span>
</span></span><span class="line"><span class="cl">        <span class="n">bob_public_key</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">bob_private_key</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Bob -&gt; Alice (Public Key): </span><span class="si">{</span><span class="n">bob_public_key</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># --- 4. Calculate shared secret &amp; generate symmetric key ---</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># The server simulates Alice and calculates the shared secret (g^b)^a mod p</span>
</span></span><span class="line"><span class="cl">        <span class="n">shared_secret_alice</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">bob_public_key</span><span class="p">,</span> <span class="n">alice_private_key</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># The server also simulates Bob to calculate the shared secret (g^a)^b mod p</span>
</span></span><span class="line"><span class="cl">        <span class="n">shared_secret_bob</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">alice_public_key</span><span class="p">,</span> <span class="n">bob_private_key</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Server-side verification to ensure the algorithm is implemented correctly</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">shared_secret_alice</span> <span class="o">==</span> <span class="n">shared_secret_bob</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[V] Verification successful! Computed the same shared secret.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Convert the shared secret (a large number) to a 32-byte key using SHA-256</span>
</span></span><span class="line"><span class="cl">        <span class="n">secret_bytes</span> <span class="o">=</span> <span class="n">shared_secret_alice</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">((</span><span class="n">shared_secret_alice</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span> <span class="o">+</span> <span class="mi">7</span><span class="p">)</span> <span class="o">//</span> <span class="mi">8</span><span class="p">,</span> <span class="n">byteorder</span><span class="o">=</span><span class="s1">&#39;big&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">symmetric_key</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">secret_bytes</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># --- 5. Use AES-256-CBC to encrypt and send the message ---</span>
</span></span><span class="line"><span class="cl">        <span class="n">conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;Alice: Message is encrypted. Here it is.</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Encrypt Alice&#39;s message</span>
</span></span><span class="line"><span class="cl">        <span class="n">flag</span> <span class="o">=</span> <span class="n">get_flag</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">alice_part</span> <span class="o">=</span> <span class="n">flag</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">plaintext_alice</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;Great. The first part is: </span><span class="si">{</span><span class="n">alice_part</span><span class="si">}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">iv_alice</span> <span class="o">=</span> <span class="n">get_random_bytes</span><span class="p">(</span><span class="n">AES</span><span class="o">.</span><span class="n">block_size</span><span class="p">)</span> <span class="c1"># Generate a random 16-byte IV</span>
</span></span><span class="line"><span class="cl">        <span class="n">cipher_alice</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">symmetric_key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv_alice</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">ciphertext_alice</span> <span class="o">=</span> <span class="n">cipher_alice</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">pad</span><span class="p">(</span><span class="n">plaintext_alice</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">block_size</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">encrypted_message_alice</span> <span class="o">=</span> <span class="n">iv_alice</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span> <span class="o">+</span> <span class="n">ciphertext_alice</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Alice -&gt; Bob (Encrypted): </span><span class="si">{</span><span class="n">encrypted_message_alice</span><span class="si">}</span><span class="se">\n</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Encrypt Bob&#39;s message</span>
</span></span><span class="line"><span class="cl">        <span class="n">bob_part</span> <span class="o">=</span> <span class="n">flag</span><span class="p">[</span><span class="mi">10</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">        <span class="n">plaintext_bob</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;Perfect! I have the rest. It&#39;s: </span><span class="si">{</span><span class="n">bob_part</span><span class="si">}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">iv_bob</span> <span class="o">=</span> <span class="n">get_random_bytes</span><span class="p">(</span><span class="n">AES</span><span class="o">.</span><span class="n">block_size</span><span class="p">)</span> <span class="c1"># A new IV must be used for each encryption</span>
</span></span><span class="line"><span class="cl">        <span class="n">cipher_bob</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">symmetric_key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv_bob</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">ciphertext_bob</span> <span class="o">=</span> <span class="n">cipher_bob</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">pad</span><span class="p">(</span><span class="n">plaintext_bob</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">block_size</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">encrypted_message_bob</span> <span class="o">=</span> <span class="n">iv_bob</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span> <span class="o">+</span> <span class="n">ciphertext_bob</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Bob -&gt; Alice (Encrypted): </span><span class="si">{</span><span class="n">encrypted_message_bob</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># --- End of eavesdropping scenario ---</span>
</span></span><span class="line"><span class="cl">        <span class="n">conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;----- Target communication terminated. Eavesdropping channel closed -----</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;[!] Error handling connection from </span><span class="si">{</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">finally</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;[-] Connection with </span><span class="si">{</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> closed, thread terminated.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Allow address reuse to avoid &#34;Address already in use&#34; errors</span>
</span></span><span class="line"><span class="cl">        <span class="n">s</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">s</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">s</span><span class="o">.</span><span class="n">listen</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;[*] Multi-threaded server listening on </span><span class="si">{</span><span class="n">HOST</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">PORT</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Wait for and accept new connections</span>
</span></span><span class="line"><span class="cl">            <span class="n">conn</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Create a new thread for this connection</span>
</span></span><span class="line"><span class="cl">            <span class="n">client_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">handle_connection</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">addr</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Start the thread</span>
</span></span><span class="line"><span class="cl">            <span class="n">client_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">()</span>
</span></span></code></pre></div></details>
<p>å¤§è‡´ä¸Šæµç¨‹æ˜¯ :</p>
<ol>
<li>é¸ä¸€å€‹å¤§è³ªæ•¸ ğ‘ï¼ˆæ¨¡æ•¸ï¼‰èˆ‡ä¸€å€‹å›ºå®šåŸºåº• ğ‘”</li>
<li>ç‚º Alice èˆ‡ Bob å„è‡ªéš¨æ©Ÿç”¢ç”Ÿç§é‘°æ•´æ•¸ ğ‘,ğ‘</li>
<li>è¨ˆç®—å…¬é–‹é‡‘é‘°
<ul>
<li>Alice è¨ˆç®— ğ´ â‰¡ ğ‘”ğ‘ (mod ğ‘)</li>
<li>Bob è¨ˆç®— ğµ â‰¡ ğ‘”ğ‘ (modğ‘)</li>
<li>é€™å…©å€‹ ğ´,ğµ æ˜¯å¯ä»¥å…¬é–‹å‚³è¼¸çš„å€¼ï¼ˆä¸ç›´æ¥æ´©éœ²ç§é‘°ï¼‰</li>
</ul>
</li>
<li>Alice èˆ‡ Bob å„è‡ªä½¿ç”¨å°æ–¹çš„å…¬é–‹é‡‘é‘°è¨ˆç®—å…±äº«ç¥•å¯†ï¼š
<ul>
<li>Alice å¾—åˆ°<br>
$$s \equiv B^{a} \pmod{p}.$$</li>
<li>Bob å¾—åˆ°<br>
$$s \equiv A^{b} \pmod{p}.$$
å…©é‚Šçš„ (s) æ‡‰è©²ç›¸åŒï¼Œæˆç‚ºé›™æ–¹å…±ç”¨çš„åŸå§‹å¯†é‘°ææ–™ã€‚</li>
</ul>
</li>
<li>å¾å…±äº«ç¥•å¯†æ´¾ç”Ÿå°ç¨±é‡‘é‘°
<ul>
<li>å°‡æ•´æ•¸å½¢å¼çš„å…±äº«ç¥•å¯† (s) è½‰ç‚ºä½å…ƒçµ„ï¼ˆbyte sequenceï¼‰ã€‚</li>
<li>å°è©²ä½å…ƒçµ„åš SHA-256ï¼ˆæˆ–å…¶ä»– KDFï¼‰ï¼Œè¼¸å‡ºå›ºå®šé•·åº¦ï¼ˆ32 bytesï¼‰çš„å°ç¨±é‡‘é‘° <code>key</code>ã€‚</li>
</ul>
</li>
<li>ç”¨ AES-CBC åŠ å¯†è¨Šæ¯
<ul>
<li>ç‚ºæ¯æ®µè¨Šæ¯ç”¢ç”Ÿéš¨æ©Ÿ IVï¼ˆ16 bytesï¼‰ã€‚</li>
<li>ä½¿ç”¨ AES-CBC æ¨¡å¼èˆ‡æ´¾ç”Ÿå‡ºçš„ <code>key</code> åŠ å¯†ï¼Œä¸¦ä½¿ç”¨ PKCS#7 åšå¡«å……ï¼ˆpaddingï¼‰ã€‚</li>
<li>æœ€çµ‚çµ„åˆæ ¼å¼é€šå¸¸ç‚º <code>IV || ciphertext</code>ï¼Œä¸¦ä»¥ hex ç·¨ç¢¼è¼¸å‡ºã€‚</li>
</ul>
</li>
<li>ä¼ºæœå™¨è¼¸å‡º
<ul>
<li>å°‡ (A)ã€(B) èˆ‡å…©å€‹ <code>IV||ciphertext</code>ï¼ˆhexï¼‰å°å‡ºæˆ–ç™¼é€çµ¦é€£ç·šè€…ï¼è§€å¯Ÿè€…ã€‚</li>
</ul>
</li>
</ol>
<div class="warning-box">
<strong>
å¼±é»åˆ†æ : 
å› ç‚º (p-1) éåº¦å¹³æ»‘ï¼Œæ‰€ä»¥å¯ä»¥ç”¨æ•¸è«–æ–¹æ³•é‚„åŸç§é‘°ä¸¦è§£å¯†é€šè¨Šã€‚
</strong>
</div>
<details close><summary>è§£å¯†è…³æœ¬</summary>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">discrete_log</span><span class="p">,</span> <span class="n">primitive_root</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">sha256</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">Crypto.Util.Padding</span> <span class="kn">import</span> <span class="n">unpad</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="mi">155214169224186174245759019817233758959712483609876556421679567759735878173206273314271380424223420051598278563855517852997101246947883176353747918435174813511975576536353646684036755728974423538143090186411163821396091652013002565116673426504500657692938270440503451481091007910872038288051399770068237950977</span>
</span></span><span class="line"><span class="cl"><span class="n">A</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s2">&#34;58103644518129580046773885573799996076986618474442320249352641149668519880147760961844672711145377690160627449524702839267898917015976382273684052077032095986159415501337432604451912098442052617534762855464323571417309209702844313240763100432911994367127812524350681410230500381401324278256932840098699875782&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">B</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s2">&#34;26531100068815027105673152185465347817772094727479605612456005614009365800124031990766921976467670530628128837084119247866737980866556496350568597597648675844025558224668354008979885168623092896378095601327146953618717617801316388934568805053835469141264747098880949411001206562144150170096058604289482052471&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ciphertexts (IV||CT as hex)</span>
</span></span><span class="line"><span class="cl"><span class="n">ct1_hex</span> <span class="o">=</span> <span class="s2">&#34;d4bcb063e31880cf777466421235e0ea78480a52ee1b62f147d93a656d31d1ea7bbdc974cc37995597a9e1988751256bbbf969e886fcb6d6e59bc6f382c77df9&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">ct2_hex</span> <span class="o">=</span> <span class="s2">&#34;b144437652fd2f4eb87acd676101c4b1fb563cbb6a8b76e8e0d183e45c1a10f5dade60334347c96e478ba0594ba448683393d4457066b8d978ede44328e90b042338d01b5dadff3485ef536a10d7b980eea3380a21825518cbd254c7b123efcc&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ‰¾ä¸€å€‹æœ¬åŸæ ¹ï¼ˆé¡Œç›®ä¸­ä¸ä¸€å®šçµ¦ gï¼Œé€™è£¡ç”¨ sympy æ‰¾åˆ°çš„ä¸€å€‹ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">g</span> <span class="o">=</span> <span class="n">primitive_root</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¨ˆç®—é›¢æ•£å°æ•¸ a: g^a = A (mod p)</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="n">discrete_log</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ç”¢ç”Ÿå…±äº«ç¥•å¯†ä¸¦ derive AES key</span>
</span></span><span class="line"><span class="cl"><span class="n">shared</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sbytes</span> <span class="o">=</span> <span class="n">shared</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">((</span><span class="n">shared</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span><span class="o">+</span><span class="mi">7</span><span class="p">)</span><span class="o">//</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;big&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">key</span> <span class="o">=</span> <span class="n">sha256</span><span class="p">(</span><span class="n">sbytes</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">aes_cbc_decrypt</span><span class="p">(</span><span class="n">hexblob</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">iv</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">hexblob</span><span class="p">[:</span><span class="mi">32</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">ct</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">hexblob</span><span class="p">[</span><span class="mi">32</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl">    <span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">unpad</span><span class="p">(</span><span class="n">cipher</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">ct</span><span class="p">),</span> <span class="n">AES</span><span class="o">.</span><span class="n">block_size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pt1</span> <span class="o">=</span> <span class="n">aes_cbc_decrypt</span><span class="p">(</span><span class="n">ct1_hex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">pt2</span> <span class="o">=</span> <span class="n">aes_cbc_decrypt</span><span class="p">(</span><span class="n">ct2_hex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">pt1</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">pt2</span><span class="o">.</span><span class="n">d</span>
</span></span></code></pre></div></details>
<p>ç ´è§£æ€è·¯ :</p>
<ol>
<li>è¼‰å…¥åƒæ•¸ï¼špã€Aã€B èˆ‡å¯†æ–‡ï¼ˆIV||CTï¼‰ã€‚</li>
<li>ç”¨ <code>sympy.primitive_root(p)</code> æ‰¾ä¸€å€‹åŸæ ¹ <code>g</code>ã€‚ï¼ˆæ³¨æ„ï¼š<strong>å¿…é ˆèˆ‡ä¼ºæœç«¯ç”¨çš„ g ä¸€è‡´ï¼Œå¦å‰‡çµæœæœƒä¸å°</strong>ã€‚ï¼‰</li>
<li>ç”¨ <code>sympy.discrete_log(p, A, g)</code> æ±‚å‡ºæ»¿è¶³ <code>g**a â‰¡ A (mod p)</code> çš„æŒ‡æ•¸ <code>a</code>ã€‚</li>
<li>è¨ˆç®—å…±äº«ç¥•å¯†ï¼š<code>shared = pow(B, a, p)</code>ã€‚</li>
<li>å°‡ <code>shared</code> è½‰æˆä½å…ƒçµ„ï¼ˆbytesï¼‰ï¼Œä¸¦å°è©²ä½å…ƒçµ„åš <code>sha256</code>ï¼Œå¾—åˆ° AES-256 é‡‘é‘°ï¼ˆ<code>key</code>ï¼‰ã€‚</li>
<li>ä½¿ç”¨è©² <code>key</code> å°æ¯å€‹ <code>IV||CT</code> åš AES-CBC è§£å¯†ä¸¦ <code>unpad</code>ï¼Œå°å‡ºæ˜æ–‡ã€‚</li>
</ol>
<div class="flag-box">
<strong>
flag :  is1abCTF{D1ff1e_h3llm4n_W1th_Sm0o7h_4t7Ack}
</strong>
</div>
<h2 id="reverse">Reverse</h2>
<h3 id="baby-reverse">Baby Reverse</h3>
<p><img src="../../images/2025_islab_Baby-Reverse.png" alt="image"></p>
<p>æŠŠé¡Œç›®çµ¦çš„ <code>annoy.exe</code> ä¸Ÿåˆ° IDA çœ‹ï¼Œè€æ¨£å­ï¼ŒAll u need is F5</p>
<details close><summary> main() </summary>
```cpp
int __cdecl main(int argc, const char **argv, const char **envp)
{
  char v4[112]; // [rsp+20h] [rbp-90h] BYREF
  char *v5; // [rsp+90h] [rbp-20h]
  char *v6; // [rsp+98h] [rbp-18h]
  char *v7; // [rsp+A0h] [rbp-10h]
  void *Block; // [rsp+A8h] [rbp-8h]
<p>_main();
printf(&ldquo;Please input the password: &ldquo;);
scanf(&quot;%99s&rdquo;, v4);
Block = (void *)crypt_func1(v4);
v7 = (char *)crypt_func2((char *)Block);
v6 = (char *)crypt_func3(v7);
v5 = (char *)crypt_func4(v6);
check(v5);
free(Block);
free(v7);
free(v6);
free(v5);
system(&ldquo;pause&rdquo;);
return 0;</p>
<pre tabindex="0"><code>&lt;/details&gt;

ç¨‹å¼ä¸»æµç¨‹:

1. ç¨‹å¼æœƒè®€å…¥æœ€å¤š 99 å­—å…ƒåˆ° v4ï¼Œä¹Ÿå°±æ˜¯è¦è¼¸å…¥çš„å¯†ç¢¼
2. ç„¶å¾Œé€²è¡ŒåŠ å¯†/è½‰æ›æµç¨‹ï¼Œä¾åºå‘¼å« crypt_func1 â†’ crypt_func2 â†’ crypt_func3 â†’ crypt_func4
3. æœ€å¾Œä¸Ÿçµæœåˆ° check(v5) 
4. é‡‹æ”¾è¨˜æ†¶é«”

æ¥ä¸‹ä¾†å»è¿½ crypt_func1~4 çš„ç¨‹å¼ç¢¼

&lt;details close&gt;&lt;summary&gt;crypt_func1(char *a1)&lt;/summary&gt;

```cpp
_BYTE *__fastcall crypt_func1(char *a1)
{
 _BYTE *v2; // [rsp+20h] [rbp-10h]
 int v3; // [rsp+28h] [rbp-8h]
 int i; // [rsp+2Ch] [rbp-4h]

 v3 = strlen(a1);
 v2 = malloc(v3 + 1);
 for ( i = 0; i &lt; v3; ++i )
   v2[i] = a1[i] ^ 0x11;
 v2[v3] = 0;
 return v2;
}
</code></pre></details>
<p>crypt_func1 : æŠŠæ¯å€‹å­—å…ƒè·Ÿ <code>0x11</code> åš XOR</p>
<p>Reverse : å† XOR ä¸€æ¬¡ <code>0x11</code></p>
<details close><summary>crypt_func2(char *a1)</summary>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">_BYTE</span> <span class="o">*</span><span class="kr">__fastcall</span> <span class="nf">crypt_func2</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">a1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="n">v1</span><span class="p">;</span> <span class="c1">// dl
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">_BYTE</span> <span class="o">*</span><span class="n">v3</span><span class="p">;</span> <span class="c1">// [rsp+20h] [rbp-10h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// [rsp+28h] [rbp-8h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [rsp+2Ch] [rbp-4h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">v4</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">a1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v3</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">v4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v4</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">v1</span> <span class="o">=</span> <span class="n">a1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">38</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">      <span class="n">v1</span> <span class="o">=</span> <span class="n">a1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">17</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">v3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">v3</span><span class="p">[</span><span class="n">v4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">v3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></details>
<p>crypt_func2 : æ ¹æ“šç´¢å¼•å¥‡å¶åšåŠ /æ¸›</p>
<p>Reverse :</p>
<ul>
<li>å¶æ•¸ä½ç½®ï¼šorig = enc + 17</li>
<li>å¥‡æ•¸ä½ç½®ï¼šorig = enc - 38</li>
</ul>
<details close><summary>crypt_func3(char *a1)</summary>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">_BYTE</span> <span class="o">*</span><span class="kr">__fastcall</span> <span class="nf">crypt_func3</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">a1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">_BYTE</span> <span class="o">*</span><span class="n">v2</span><span class="p">;</span> <span class="c1">// [rsp+20h] [rbp-10h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// [rsp+28h] [rbp-8h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [rsp+2Ch] [rbp-4h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">v3</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">a1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v2</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">v3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v3</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">v2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">9</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="n">v2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="mh">0x4D</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">v2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">v2</span><span class="p">[</span><span class="n">v3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">v2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></details>
<p>crypt_func3 : æ ¹æ“š i mod 3 åšä¸çš„è™•ç†</p>
<p>Reverse:</p>
<ul>
<li>i % 3 == 0 â†’ orig = enc - 5</li>
<li>i % 3 == 1 â†’ orig = enc + 9</li>
<li>i % 3 == 2 â†’ orig = enc ^ 0x4D</li>
</ul>
<details close><summary>crypt_func4(char *a1)</summary>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">_BYTE</span> <span class="o">*</span><span class="kr">__fastcall</span> <span class="nf">crypt_func4</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">a1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">_BYTE</span> <span class="o">*</span><span class="n">v2</span><span class="p">;</span> <span class="c1">// [rsp+20h] [rbp-60h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// [rsp+28h] [rbp-58h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [rsp+2Ch] [rbp-54h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">v3</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">a1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v2</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">v3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v3</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">v2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ror1</span><span class="p">(</span><span class="n">a1</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v2</span><span class="p">[</span><span class="n">v3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">v2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></details>
<p>crypt_func4 : rotate right 1 bit (ROR 1)</p>
<p>Reverse : åš ROL 1</p>
<details close><summary>check()</summary>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kr">__int64</span> <span class="kr">__fastcall</span> <span class="nf">check</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">a1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">size_t</span> <span class="n">v2</span><span class="p">;</span> <span class="c1">// rbx
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">Str</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span> <span class="c1">// [rsp+20h] [rbp-60h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// [rsp+28h] [rbp-58h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// [rsp+30h] [rbp-50h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// [rsp+38h] [rbp-48h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// [rsp+40h] [rbp-40h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">__int64</span> <span class="n">v8</span><span class="p">;</span> <span class="c1">// [rsp+48h] [rbp-38h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [rsp+5Ch] [rbp-24h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="n">Str</span> <span class="o">=</span> <span class="mh">0x3A9C9AACCD21BF36</span><span class="n">i64</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v4</span> <span class="o">=</span> <span class="mh">0xC90DC22EE285A60Au</span><span class="n">i64</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v5</span> <span class="o">=</span> <span class="mh">0xE2A4A68D9FAB9C27u</span><span class="n">i64</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span> <span class="o">=</span> <span class="mh">0xB50BEA04D18EB534u</span><span class="n">i64</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v7</span> <span class="o">=</span> <span class="mh">0xBC2ECB8CEA1A51AEu</span><span class="n">i64</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v8</span> <span class="o">=</span> <span class="mh">0x294D2C4B35E9A4</span><span class="n">i64</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">v2</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="n">v2</span> <span class="o">&gt;=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">Str</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="n">Str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">a1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">puts</span><span class="p">(</span><span class="s">&#34;Wrong!!!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="mi">0</span><span class="n">i64</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">puts</span><span class="p">(</span><span class="s">&#34;Correct!!!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">1</span><span class="n">i64</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></details>
<p>ç°¡å–®ä¾†èªªå°±æ˜¯æŠŠè¼¸å…¥ (a1 = v5) å’Œå…§å»ºçš„ Str æ¯”å°</p>
<p>è©±ä¸å¤šèªªï¼Œè…³æœ¬ä¼éµå•Ÿå‹•</p>
<details close><summary>solve.py ç¨‹å¼ç¢¼</summary>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># --- Reverse crypt_func4 (rol1) ---</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">rol1</span><span class="p">(</span><span class="n">byte</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">((</span><span class="n">byte</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">byte</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">reverse_crypt_func4</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">rol1</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">data</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># --- Reverse crypt_func3 ---</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">reverse_crypt_func3</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">9</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="mh">0x4D</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># --- Reverse crypt_func2 ---</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">reverse_crypt_func2</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Even index</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">17</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>           <span class="c1"># Odd index</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">38</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># --- Reverse crypt_func1 ---</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">reverse_crypt_func1</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">b</span> <span class="o">^</span> <span class="mh">0x11</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">data</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># --- Execute decryption process ---</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">encrypted_flag</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Step 1: Reverse crypt_func4</span>
</span></span><span class="line"><span class="cl">    <span class="n">decrypted_4</span> <span class="o">=</span> <span class="n">reverse_crypt_func4</span><span class="p">(</span><span class="n">encrypted_flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Decrypted 4 (Output of func3): </span><span class="si">{</span><span class="n">decrypted_4</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Step 2: Reverse crypt_func3</span>
</span></span><span class="line"><span class="cl">    <span class="n">decrypted_3</span> <span class="o">=</span> <span class="n">reverse_crypt_func3</span><span class="p">(</span><span class="n">decrypted_4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Decrypted 3 (Output of func2): </span><span class="si">{</span><span class="n">decrypted_3</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Step 3: Reverse crypt_func2</span>
</span></span><span class="line"><span class="cl">    <span class="n">decrypted_2</span> <span class="o">=</span> <span class="n">reverse_crypt_func2</span><span class="p">(</span><span class="n">decrypted_3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Decrypted 2 (Output of func1): </span><span class="si">{</span><span class="n">decrypted_2</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Step 4: Reverse crypt_func1</span>
</span></span><span class="line"><span class="cl">    <span class="n">password_bytes</span> <span class="o">=</span> <span class="n">reverse_crypt_func1</span><span class="p">(</span><span class="n">decrypted_2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">final_password</span> <span class="o">=</span> <span class="n">password_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Final fix: If your result contains &#39;~&#39;, try replacing it</span>
</span></span><span class="line"><span class="cl">    <span class="n">final_password</span> <span class="o">=</span> <span class="n">final_password</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">--- Decryption complete! ---&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;The password is: </span><span class="si">{</span><span class="n">final_password</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">final_password</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Final encrypted string from the &#39;check&#39; function (in little-endian format)</span>
</span></span><span class="line"><span class="cl"><span class="n">encrypted_flag</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="s1">&#39;36BF21CDAC9A9C3A0AA685E22EC20DC9279CAB9F8DA6A4E234B58ED104EA0BB5AE511ACE8CCB2EBCA4E9354B2C4D29&#39;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Run the decryption process</span>
</span></span><span class="line"><span class="cl"><span class="n">decrypted_password</span> <span class="o">=</span> <span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted_flag</span><span class="p">)</span>
</span></span></code></pre></div></details>
<div class="flag-box">
<strong>
flag : is1abCTF{34syyyyy_r3v3rse_pi3c3_0f_4k3_righ7}
</strong>
</div>
<h3 id="basic-crackme">Basic Crackme</h3>
<p><img src="../../images/2025_islab_Basic-Crackme.png" alt="image"></p>
<p>ä¸€æ¨£æŠŠæª”æ¡ˆä¸Ÿé€² IDA</p>
<details close><summary>main()</summary>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">v4</span><span class="p">;</span> <span class="c1">// [rsp+20h] [rbp-128h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">v5</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span> <span class="c1">// [rsp+30h] [rbp-118h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Please input the key: &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">sub_140001740</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span> <span class="n">v5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">sub_1400013A0</span><span class="p">(</span><span class="n">v5</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">v4</span> <span class="o">=</span> <span class="n">sub_140001000</span><span class="p">(</span><span class="n">v5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;CONGRATULATIONS, YOU PASSED!!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Here is your flag: %s</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="n">v4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;SORRY, YOU FAILED!!!!!!!!!!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></details>
<ol>
<li>v5[256] è®€å…¥ä½¿ç”¨è€…è¼¸å…¥ï¼ˆ<code>sub_140001740(&quot;%s&quot;, v5)</code>ï¼‰ã€‚</li>
<li>å‘¼å« <code>sub_1400013A0(v5)</code>ï¼šé©—è­‰å‡½å¼ï¼Œè¿”å› unsigned intï¼Œéé›¶è¡¨ç¤ºé©—è­‰é€šéã€‚</li>
<li>è‹¥é€šéï¼Œ<code>å‘¼å« sub_140001000(v5)</code>ï¼Œå›å‚³ const char *ï¼ˆå¾ˆå¯èƒ½æ˜¯è§£å¯†å¾Œæˆ–ç”Ÿæˆçš„ flag å­—ä¸²ï¼‰ï¼Œç„¶å¾Œ printf å‡ºä¾†ï¼Œå¦å‰‡è¼¸å‡ºå¤±æ•—ã€‚</li>
</ol>
<p>æ¥ä¸‹ä¾†å°±å»æ‰¾ <code>sub_1400013A0(v5)</code></p>
<details close><summary>sub_1400013A0(const char *a1)</summary>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">_BOOL8</span> <span class="kr">__fastcall</span> <span class="nf">sub_1400013A0</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">a1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">j</span><span class="p">;</span> <span class="c1">// [rsp+20h] [rbp-48h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [rsp+28h] [rbp-40h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="o">*</span><span class="n">Destination</span><span class="p">;</span> <span class="c1">// [rsp+30h] [rbp-38h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">BOOL</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// [rsp+3Ch] [rbp-2Ch]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// [rsp+40h] [rbp-28h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// [rsp+44h] [rbp-24h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v8</span><span class="p">;</span> <span class="c1">// [rsp+48h] [rbp-20h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">_DWORD</span> <span class="o">*</span><span class="n">Block</span><span class="p">;</span> <span class="c1">// [rsp+50h] [rbp-18h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">strlen</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">37</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="n">i64</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">Destination</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">j__malloc_base</span><span class="p">(</span><span class="mh">0x28u</span><span class="n">i64</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">strcpy_s</span><span class="p">(</span><span class="n">Destination</span><span class="p">,</span> <span class="mh">0x28u</span><span class="n">i64</span><span class="p">,</span> <span class="n">a1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Destination</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">37</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">Block</span> <span class="o">=</span> <span class="n">j__malloc_base</span><span class="p">(</span><span class="mh">0x28u</span><span class="n">i64</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">v6</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">sub_140001240</span><span class="p">(</span><span class="n">Destination</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">v7</span> <span class="o">=</span> <span class="p">((</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">sub_140001240</span><span class="p">(</span><span class="n">Destination</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">3</span><span class="p">])</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="n">v6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">v8</span> <span class="o">=</span> <span class="p">((</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">sub_140001240</span><span class="p">(</span><span class="n">Destination</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">v7</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Block</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">sub_140001240</span><span class="p">(</span><span class="n">Destination</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="n">j</span><span class="p">])</span> <span class="o">|</span> <span class="n">v8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">v5</span> <span class="o">=</span> <span class="n">sub_1400012E0</span><span class="p">((</span><span class="kr">__int64</span><span class="p">)</span><span class="n">Block</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">free</span><span class="p">(</span><span class="n">Destination</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">free</span><span class="p">(</span><span class="n">Block</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">v5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></details>
<ol>
<li>è¼¸å…¥é•·åº¦å¿…é ˆæ˜¯ 37ï¼ˆå¦å‰‡ç›´æ¥å¤±æ•—ï¼‰ã€‚</li>
<li>Destination è¢«è£œæˆ 40 bytesï¼ˆåœ¨å°¾ç«¯è¿½åŠ ä¸‰å€‹å­—ç¯€ 0x03ï¼‰ï¼Œæ‰€ä»¥æ¥ä¸‹ä¾†çš„ 10 å€‹ 4-byte groupsï¼ˆç¸½å…± 40 bytesï¼‰éƒ½æœƒè¢«è™•ç†ã€‚</li>
<li>æ¯ 4 å€‹å­—å…ƒæœƒç¶“é sub_140001240ï¼ˆä¸€å€‹ byte-&gt;byte çš„è½‰æ›å‡½å¼ï¼‰ï¼Œç„¶å¾ŒæŒ‰ç‰¹æ®Šé †åºçµ„æˆä¸€å€‹ 32-bit æ•´æ•¸æ”¾å…¥ Block[j]ã€‚</li>
<li>æœ€å¾Œ Blockï¼ˆ10 å€‹ 32-bitï¼Œåˆè¨ˆ 40 bytesï¼‰è¢«äº¤çµ¦ sub_1400012E0 åšæœ€çµ‚é©—è­‰ï¼›è‹¥è©²å‡½å¼å›å‚³é 0ï¼Œå‰‡é©—è­‰æˆåŠŸã€‚</li>
</ol>
<p>é€™é‚Šè¦æ³¨æ„å­—ç¯€çš„é †åº :</p>
<ol>
<li>Block[j] çš„æœ€ä½ä½å…ƒçµ„ (= byte0) = <code>sub_140001240(Destination[4*j + 0])</code></li>
<li>ç¬¬ 1 å€‹ä½å…ƒçµ„ (= byte1) = <code>sub_140001240(Destination[4*j + 2])</code> ï¼ˆå› ç‚ºå®ƒæ˜¯è¢«å·¦ç§» 8 ä½æ”¾åœ¨ bits8-15ï¼‰</li>
<li>ç¬¬ 2 å€‹ä½å…ƒçµ„ (= byte2) = <code>sub_140001240(Destination[4*j + 3])</code> ï¼ˆleft &laquo; 16ï¼‰</li>
<li>ç¬¬ 3 å€‹ä½å…ƒçµ„ (= byte3) = <code>sub_140001240(Destination[4*j + 1])</code> ï¼ˆleft &laquo; 24ï¼‰</li>
</ol>
<p>ç¸½è€Œè¨€ä¹‹å°±æ˜¯ : æ¯çµ„ 4 å­—å…ƒ (c0 c1 c2 c3) ç¶“é sub_140001240 å¾Œæœƒä»¥é †åº [c0, c2, c3, c1] æ”¾å…¥ 32-bitï¼ˆå¾ä½ä½åˆ°é«˜ä½ï¼‰</p>
<p>æ¥ä¸‹ä¾†è¦ç¹¼çºŒè¿½ <code>sub_140001240</code>ã€<code>sub_1400012E0</code></p>
<details close><summary>sub_140001240(char a1)</summary>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kr">__int64</span> <span class="kr">__fastcall</span> <span class="nf">sub_140001240</span><span class="p">(</span><span class="kt">char</span> <span class="n">a1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="n">v2</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span> <span class="c1">// [rsp+0h] [rbp-28h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">v2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v2</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v2</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v2</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v2</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v2</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v2</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v2</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v2</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v2</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v2</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v2</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v2</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v2</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span><span class="mi">16</span> <span class="o">*</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">v2</span><span class="p">[</span><span class="n">a1</span> <span class="o">&amp;</span> <span class="mh">0xF</span><span class="p">])</span> <span class="o">|</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)(</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">v2</span><span class="p">[</span><span class="n">a1</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></details>
<p><code>sub_140001240</code> : æŠŠè¼¸å…¥å­—ç¯€çš„é«˜/ä½åŠä½å…ƒçµ„ï¼ˆnibbleï¼‰å„è‡ªé€éä¸€å€‹é•·åº¦ 16 çš„ç½®æ›è¡¨ v2 æ˜ å°„ï¼Œå†æŠŠ low-mapped æ”¾åˆ°é«˜ä½ï¼ˆä¹˜ 16ï¼‰ï¼Œhigh-mapped æ”¾åˆ°ä½ä½</p>
<details close><summary>sub_1400012E0(__int64 a1)</summary>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kr">__int64</span> <span class="kr">__fastcall</span> <span class="nf">sub_1400012E0</span><span class="p">(</span><span class="kr">__int64</span> <span class="n">a1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [rsp+0h] [rbp-48h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v3</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span> <span class="c1">// [rsp+8h] [rbp-40h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">v3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">433789332</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40534546</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v3</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1815012958</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v3</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">695967214</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v3</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1819172522</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v3</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1396925846</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v3</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">429986636</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v3</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">324766550</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v3</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1031501274</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v3</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1061109718</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">a1</span> <span class="o">+</span> <span class="mi">4</span><span class="n">i64</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">!=</span> <span class="n">v3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="mi">0</span><span class="n">i64</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">1</span><span class="n">i64</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></details>
<p><code>sub_1400012E0</code>ï¼šæŠŠ Block èˆ‡ä¸€çµ„å¸¸æ•¸ v3[0..9] æ¯”å°ï¼Œå®Œå…¨ç›¸ç­‰æ‰å›å‚³æˆåŠŸ</p>
<p>æœ€å¾Œä¾†çœ‹ <code>sub_140001000</code>ï¼Œä»–æ˜¯ç”¢ç”Ÿ flag çš„å‡½å¼</p>
<details close><summary>sub_140001000(const char *a1)</summary>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">_BYTE</span> <span class="o">*</span><span class="kr">__fastcall</span> <span class="nf">sub_140001000</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">a1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [rsp+20h] [rbp-58h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// [rsp+24h] [rbp-54h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">_BYTE</span> <span class="o">*</span><span class="n">v4</span><span class="p">;</span> <span class="c1">// [rsp+28h] [rbp-50h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">int</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// [rsp+30h] [rbp-48h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">v6</span><span class="p">[</span><span class="mi">22</span><span class="p">];</span> <span class="c1">// [rsp+38h] [rbp-40h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">char</span> <span class="n">v7</span><span class="p">[</span><span class="mi">18</span><span class="p">];</span> <span class="c1">// [rsp+4Eh] [rbp-2Ah] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">86</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">74</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">39</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="mi">102</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mi">87</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="mi">21</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="mi">22</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="mi">61</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span> <span class="o">=</span> <span class="mi">79</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="o">=</span> <span class="mi">17</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="o">=</span> <span class="mi">103</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v6</span><span class="p">[</span><span class="mi">21</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">qmemcpy</span><span class="p">(</span><span class="n">v7</span><span class="p">,</span> <span class="s">&#34;8baW&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v7</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">127</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v7</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">37</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v7</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">37</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v7</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">114</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v7</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mi">26</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v7</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="mi">85</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v7</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v7</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="mi">28</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v7</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v7</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="mi">18</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v7</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="mi">41</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v4</span> <span class="o">=</span> <span class="n">j__malloc_base</span><span class="p">(</span><span class="mh">0x26u</span><span class="n">i64</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">v3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">v5</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">a1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span> <span class="n">v3</span> <span class="o">&lt;</span> <span class="mi">37</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">v4</span><span class="p">[</span><span class="n">v3</span><span class="p">]</span> <span class="o">=</span> <span class="n">a1</span><span class="p">[</span><span class="n">v3</span> <span class="o">%</span> <span class="n">v5</span><span class="p">]</span> <span class="o">^</span> <span class="n">v6</span><span class="p">[</span><span class="n">v3</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="o">++</span><span class="n">v3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">v4</span><span class="p">[</span><span class="n">v3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">37</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">v4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">65</span> <span class="o">||</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">v4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">90</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">v4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">97</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">v4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">122</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">v4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="kt">char</span><span class="p">)</span><span class="n">v4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">84</span><span class="p">)</span> <span class="o">%</span> <span class="mi">26</span> <span class="o">+</span> <span class="mi">97</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">v4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="kt">char</span><span class="p">)</span><span class="n">v4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">52</span><span class="p">)</span> <span class="o">%</span> <span class="mi">26</span> <span class="o">+</span> <span class="mi">65</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">v4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></details>
<ol>
<li>æœ‰å…©å€‹é™£åˆ— v6ï¼ˆ22 bytesï¼‰èˆ‡ v7ï¼ˆ18 bytesï¼‰æ”¾åœ¨ stack ä¸Šï¼Œç¸½å…± 40 bytes çš„ XOR keyã€‚</li>
<li>v4 = malloc(0x26)ï¼ˆ38 bytes ç©ºé–“ï¼‰ï¼Œv5 = strlen(a1)ã€‚</li>
<li>è¿´åœˆ for v3=0; v3&lt;37; ++v3: v4[v3] = a1[v3 % v5] ^ v6[v3];
æ³¨æ„ï¼šv6[v3] è¶…é 22 æœƒå¾ v7 è®€ï¼ˆå› ç‚º v6 èˆ‡ v7 åœ¨ stack ä¸Šç·Šé„°ï¼‰ã€‚</li>
<li>çµæŸå¾Œå° v4 çš„æ¯å€‹å­—å…ƒï¼š
è‹¥åœ¨ A-Zï¼ˆ65..90ï¼‰ï¼Œå‰‡ v4[i] = ((v4[i] - 52) % 26) + 65
è‹¥åœ¨ a-zï¼ˆ97..122ï¼‰ï¼Œå‰‡ v4[i] = ((v4[i] - 84) % 26) + 97
å¦å‰‡ä¿ç•™</li>
<li>å›å‚³ v4ï¼ˆC å­—ä¸²ï¼‰ï¼Œmain() æœƒ printf å‡ºä¾†ã€‚</li>
</ol>
<p>ç°¡å–®ç¸½çµä¸€ä¸‹é¡Œç›®æµç¨‹ :</p>
<ol>
<li>ä½¿ç”¨è€…è¼¸å…¥ a1ï¼ˆstringï¼Œé•·åº¦ 37ï¼‰é€²å…¥ main()ã€‚</li>
<li>main() å‘¼å« sub_1400013A0(a1) åšé©—è­‰ï¼š
<ul>
<li>sub_1400013A0 æœƒæŠŠ a1ï¼ˆ37 bytesï¼‰è¤‡è£½åˆ° Destinationï¼ˆ40 bytesï¼Œå°¾ç«¯è£œä¸‰å€‹ 0x03ï¼‰ï¼Œ</li>
<li>ä»¥æ¯ 4 bytes ç‚ºä¸€çµ„ï¼Œå°æ¯å€‹ byte å‘¼å« sub_140001240ï¼ˆbyte -&gt; byte çš„ mappingï¼‰ï¼ŒæŠŠ 4 å€‹æ˜ å°„å¾Œçš„ byte çµ„æˆä¸€å€‹ 32-bitï¼Œç”¢ç”Ÿ Block[0..9]ã€‚</li>
<li>å†æŠŠ Block èˆ‡ sub_1400012E0 ä¸­çš„å¸¸æ•¸ v3[0..9] æ¯”è¼ƒï¼Œå®Œå…¨ç›¸ç­‰æ‰é€šéã€‚</li>
</ul>
</li>
<li>é€šéé©—è­‰å¾Œ main() å‘¼å« sub_140001000(a1)ï¼Œè©²å‡½å¼æœƒå° a1 åš XOR èˆ‡å­—ç¬¦ç¯„åœæ˜ å°„ï¼Œå›å‚³ flag-like å­—ä¸²ï¼ˆæœƒè¢« printf å°å‡ºï¼‰ã€‚</li>
</ol>
<p>Rerverse æ­¥é©Ÿ:</p>
<p><code>sub_140001240(char a1)</code></p>
<ol>
<li>å»º inv_v2ï¼šæŠŠ v2 çš„å€¼å°æ‡‰åˆ°åŸ nibbleï¼ˆinv_v2[mapped]=original_nibbleï¼‰ã€‚</li>
<li>çµ¦å®š mapped_byteï¼š
mapped_high_nibble = mapped_byte &amp; 0xF
mapped_low_nibble = mapped_byte &raquo; 4
åŸ low nibble = inv_v2[mapped_high_nibble]
åŸ high nibble = inv_v2[mapped_low_nibble]
åŸ byte = (orig_high &laquo; 4) | orig_low</li>
</ol>
<p><code>sub_1400013A0(const char *a1)</code></p>
<ol>
<li>è®€å‡º sub_1400012E0 è£¡çš„ 10 å€‹å¸¸æ•¸ v3[0..9]ã€‚</li>
<li>æŠŠæ¯å€‹å¸¸æ•¸è½‰ç‚º 4-bytes little-endianï¼šb0,b1,b2,b3ã€‚</li>
<li>æ ¹æ“šä¸Šé¢çš„æ’åˆ—ï¼Œé‡å°æ¯å€‹ mapped byte bi ç”¨ sub240 é€†æ¨å¾—åˆ°åŸå§‹ Destination å°æ‡‰ byteï¼ˆæ³¨æ„ç´¢å¼•æ˜¯ D[4j+0], D[4j+1], D[4j+2], D[4j+3] çš„ç‰¹æ®Šå°æ‡‰ï¼‰ã€‚</li>
<li>æ‹¼å‡º 40 bytes Destinationï¼Œæª¢æŸ¥ tail æ˜¯å¦ç‚º \x03\x03\x03ï¼ˆé©—è­‰æˆåŠŸï¼‰ã€‚</li>
<li>Destination[:37] å³ keyã€‚</li>
</ol>
<p><code>sub_1400012E0(__int64 a1)</code></p>
<ol>
<li>å¾åç·¨è­¯è¤‡è£½ v6 èˆ‡ v7ï¼ˆv7 ç·Šæ¥ v6 çš„å€¼ï¼‰ã€‚</li>
<li>æŠŠ Destination[:37] ç•¶ä½œ input keyï¼Œé€å­—åš XORï¼Œç„¶å¾ŒåŸ·è¡Œå­—å…ƒç¯„åœæ˜ å°„å¾—åˆ°æœ€å¾Œè¼¸å‡ºã€‚</li>
</ol>
<p>è…³æœ¬ä¼éµ :</p>
<details close><summary>solve.py</summary>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ---- åæ˜ å°„è¡¨ï¼ˆsub_140001240 ä¸­çš„ v2ï¼‰ ----</span>
</span></span><span class="line"><span class="cl"><span class="n">V2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">15</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">sub240_encode</span><span class="p">(</span><span class="n">byte_val</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;æ¨¡æ“¬ sub_140001240 çš„è¡Œç‚ºï¼šæŠŠè¼¸å…¥ byte çš„ low/high nibble å„è‡ªæ˜ å°„å¾Œåˆæˆ&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span> <span class="o">=</span> <span class="n">byte_val</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
</span></span><span class="line"><span class="cl">    <span class="n">low</span> <span class="o">=</span> <span class="n">b</span> <span class="o">&amp;</span> <span class="mh">0xF</span>
</span></span><span class="line"><span class="cl">    <span class="n">high</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xF</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="mi">16</span> <span class="o">*</span> <span class="n">V2</span><span class="p">[</span><span class="n">low</span><span class="p">])</span> <span class="o">|</span> <span class="n">V2</span><span class="p">[</span><span class="n">high</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">invert_sub240_byte</span><span class="p">(</span><span class="n">target</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    å·²çŸ¥ sub240_encode(orig) == target (0..255)ï¼Œåæ¨ origï¼ˆ0..255ï¼‰ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">    ç”±æ–¼ sub240 æ“ä½œæ˜¯å° nibble å„è‡ªåšç½®æ›ï¼Œé€™å€‹åå‘æ˜¯å”¯ä¸€çš„ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># åå‘è¡¨ï¼šå¾æ˜ å°„å€¼ -&gt; åŸ nibble</span>
</span></span><span class="line"><span class="cl">    <span class="n">inv</span> <span class="o">=</span> <span class="p">{</span><span class="n">V2</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">)}</span>
</span></span><span class="line"><span class="cl">    <span class="n">lo_mapped</span> <span class="o">=</span> <span class="p">(</span><span class="n">target</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xF</span>
</span></span><span class="line"><span class="cl">    <span class="n">hi_mapped</span> <span class="o">=</span> <span class="p">(</span><span class="n">target</span> <span class="o">&amp;</span> <span class="mh">0xF</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># å°‡ mapped nibble è½‰å›åŸ nibble</span>
</span></span><span class="line"><span class="cl">    <span class="n">orig_low</span> <span class="o">=</span> <span class="n">inv</span><span class="p">[</span><span class="n">lo_mapped</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">orig_high</span> <span class="o">=</span> <span class="n">inv</span><span class="p">[</span><span class="n">hi_mapped</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">orig_high</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="n">orig_low</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ---- sub_1400012E0 ä¸­çš„å¸¸æ•¸ v3 ----</span>
</span></span><span class="line"><span class="cl"><span class="n">V3</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="o">-</span><span class="mi">433789332</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mi">40534546</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1815012958</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="o">-</span><span class="mi">695967214</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="mi">1819172522</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="o">-</span><span class="mi">1396925846</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="o">-</span><span class="mi">429986636</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="o">-</span><span class="mi">324766550</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="o">-</span><span class="mi">1031501274</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="o">-</span><span class="mi">1061109718</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># è½‰æˆ unsigned 32-bit è¡¨ç¤ºï¼ˆå°æ‡‰ memory bytes çš„å°ç«¯è¡¨ç¤ºï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">V3U</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">V3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">u32_to_bytes_le</span><span class="p">(</span><span class="n">u</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;æŠŠ 32-bit unsigned æ•´æ•¸è½‰æˆ 4-bytes çš„ little-endian list&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[(</span><span class="n">u</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">i</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0xFF</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ---- é‚„åŸ Destination (40 bytes) çš„å‡½å¼ ----</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">reconstruct_destination_from_v3</span><span class="p">(</span><span class="n">v3u_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    æ¯ä¸€å€‹ v3u æ˜¯ Block[j] çš„ 32-bit å°ç«¯æ•´æ•¸ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">    Block[j] çš„ bytes (low..high) å°æ‡‰æ–¼:
</span></span></span><span class="line"><span class="cl"><span class="s2">      [ sub240(D[4*j + 0]),
</span></span></span><span class="line"><span class="cl"><span class="s2">        sub240(D[4*j + 2]),
</span></span></span><span class="line"><span class="cl"><span class="s2">        sub240(D[4*j + 3]),
</span></span></span><span class="line"><span class="cl"><span class="s2">        sub240(D[4*j + 1]) ]
</span></span></span><span class="line"><span class="cl"><span class="s2">    æˆ‘å€‘å°æ¯å€‹ byte åæ¨ sub240 çš„åŸå§‹è¼¸å…¥ï¼Œä¸¦æ”¾å› Destination å°æ‡‰ä½ç½®ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">    æœ€å¾Œ Destination é•·åº¦ç‚º 40 bytesï¼ˆ10 * 4ï¼‰ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">dest</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">40</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">v3u_list</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">b</span> <span class="o">=</span> <span class="n">u32_to_bytes_le</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>  <span class="c1"># 4 bytes in little-endian order: b0,b1,b2,b3</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># æŒ‰ sub_1400013A0 è£¡çš„æ’åˆ—æŠŠåæ¨å¾Œçš„åŸå§‹ bytes æ”¾å› destination</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Block[j] bytes correspond to: [D[4*j+0]mapped, D[4*j+2]mapped, D[4*j+3]mapped, D[4*j+1]mapped]</span>
</span></span><span class="line"><span class="cl">        <span class="n">mapped0</span><span class="p">,</span> <span class="n">mapped1</span><span class="p">,</span> <span class="n">mapped2</span><span class="p">,</span> <span class="n">mapped3</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># åæ¨ mapped -&gt; åŸ bytes</span>
</span></span><span class="line"><span class="cl">        <span class="n">orig0</span> <span class="o">=</span> <span class="n">invert_sub240_byte</span><span class="p">(</span><span class="n">mapped0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">orig2</span> <span class="o">=</span> <span class="n">invert_sub240_byte</span><span class="p">(</span><span class="n">mapped1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">orig3</span> <span class="o">=</span> <span class="n">invert_sub240_byte</span><span class="p">(</span><span class="n">mapped2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">orig1</span> <span class="o">=</span> <span class="n">invert_sub240_byte</span><span class="p">(</span><span class="n">mapped3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">dest</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">j</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">orig0</span>
</span></span><span class="line"><span class="cl">        <span class="n">dest</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">orig1</span>
</span></span><span class="line"><span class="cl">        <span class="n">dest</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">orig2</span>
</span></span><span class="line"><span class="cl">        <span class="n">dest</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">j</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">orig3</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ---- sub_140001000 çš„æ¨¡æ“¬ï¼ˆç”¨ä¾†ç”¢ç”Ÿ flagï¼‰ ----</span>
</span></span><span class="line"><span class="cl"><span class="c1"># v6 (22 bytes) ç„¶å¾Œ v7 (18 bytes) åœ¨ stack ä¸Šç·Šæ¥ v6ã€‚ç¨‹å¼å° Destination å‰ 37 bytes åš XORã€‚</span>
</span></span><span class="line"><span class="cl"><span class="n">V6</span> <span class="o">=</span> <span class="p">[</span><span class="mi">64</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">86</span><span class="p">,</span><span class="mi">74</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">87</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">79</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># v7 åˆå§‹çš„å‰é¢ 4 bytes ä¾†è‡ª &#34;8baW&#34;ï¼Œå¾Œé¢ä¾åç·¨è­¯è³¦å€¼</span>
</span></span><span class="line"><span class="cl"><span class="n">V7</span> <span class="o">=</span> <span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="s2">&#34;8baW&#34;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">127</span><span class="p">,</span><span class="mi">37</span><span class="p">,</span><span class="mi">37</span><span class="p">,</span><span class="mi">114</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">85</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">41</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># pad v7 åˆ° 18 bytes if needed</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">V7</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">18</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">V7</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">V6V7</span> <span class="o">=</span> <span class="n">V6</span> <span class="o">+</span> <span class="n">V7</span>  <span class="c1"># 22 + 18 = 40 bytes, å°æ‡‰ Destination çš„å‰ 40 bytes ç”¨æ–¼ XOR</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">sub_140001000_simulate</span><span class="p">(</span><span class="n">input_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    æ¨¡æ“¬ sub_140001000: allocate v4, ç„¶å¾Œå°å‰ 37 bytesï¼š
</span></span></span><span class="line"><span class="cl"><span class="s2">      v4[i] = a1[i </span><span class="si">% le</span><span class="s2">n(a1)] ^ (v6_or_v7[i])  (a1 ä»¥ bytes è™•ç†)
</span></span></span><span class="line"><span class="cl"><span class="s2">    ä¹‹å¾Œå° v4 æ¯å­—å…ƒåšç¯„åœèª¿æ•´ï¼š
</span></span></span><span class="line"><span class="cl"><span class="s2">      è‹¥ 65..90 -&gt; v4[i] = ((v4[i] - 52) % 26) + 65
</span></span></span><span class="line"><span class="cl"><span class="s2">      è‹¥ 97..122 -&gt; v4[i] = ((v4[i] - 84) % 26) + 97
</span></span></span><span class="line"><span class="cl"><span class="s2">    å›å‚³ä½œç‚ºå­—ä¸²ï¼ˆlatin1 è§£ç¢¼ï¼Œèˆ‡ C çš„ 1-byte semantics å°é½Šï¼‰
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">a_bytes</span> <span class="o">=</span> <span class="n">input_key</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">)</span>  <span class="c1"># ä¿ç•™åŸå§‹ byte å€¼ 0..255</span>
</span></span><span class="line"><span class="cl">    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a_bytes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">v4</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>  <span class="c1"># allocate at least 37+1</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">37</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">ch</span> <span class="o">=</span> <span class="n">a_bytes</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="n">n</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">xor_with</span> <span class="o">=</span> <span class="n">V6V7</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
</span></span><span class="line"><span class="cl">        <span class="n">v4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ch</span> <span class="o">^</span> <span class="n">xor_with</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># apply post-processing</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">37</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">c</span> <span class="o">=</span> <span class="n">v4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="mi">65</span> <span class="o">&lt;=</span> <span class="n">c</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">v4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">c</span> <span class="o">-</span> <span class="mi">52</span><span class="p">)</span> <span class="o">%</span> <span class="mi">26</span><span class="p">)</span> <span class="o">+</span> <span class="mi">65</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="mi">97</span> <span class="o">&lt;=</span> <span class="n">c</span> <span class="o">&lt;=</span> <span class="mi">122</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">v4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">c</span> <span class="o">-</span> <span class="mi">84</span><span class="p">)</span> <span class="o">%</span> <span class="mi">26</span><span class="p">)</span> <span class="o">+</span> <span class="mi">97</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># leave unchanged</span>
</span></span><span class="line"><span class="cl">            <span class="n">v4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">v4</span><span class="p">[:</span><span class="mi">37</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ---- é©—è­‰å‡½å¼ï¼ˆæ¨¡æ“¬ sub_1400013A0 çš„ Block ç”Ÿæˆèˆ‡æ¯”å° sub_1400012E0ï¼‰ ----</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">compute_block_from_destination</span><span class="p">(</span><span class="n">dest40</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;çµ¦å®š Destination(40 bytes)ï¼Œæ¨¡æ“¬ sub_1400013A0 ä¸­ Block çš„ç”Ÿæˆï¼ˆå°ç«¯ u32 listï¼‰&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dest40</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">40</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&#34;dest must be 40 bytes&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">block</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Block[j] compositon:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># bytes: b0 = sub240(dest[4*j + 0])</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#        b1 = sub240(dest[4*j + 2])</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#        b2 = sub240(dest[4*j + 3])</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#        b3 = sub240(dest[4*j + 1])</span>
</span></span><span class="line"><span class="cl">        <span class="n">b0</span> <span class="o">=</span> <span class="n">sub240_encode</span><span class="p">(</span><span class="n">dest40</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">j</span> <span class="o">+</span> <span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">b1</span> <span class="o">=</span> <span class="n">sub240_encode</span><span class="p">(</span><span class="n">dest40</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">b2</span> <span class="o">=</span> <span class="n">sub240_encode</span><span class="p">(</span><span class="n">dest40</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">j</span> <span class="o">+</span> <span class="mi">3</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">b3</span> <span class="o">=</span> <span class="n">sub240_encode</span><span class="p">(</span><span class="n">dest40</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># little endian pack</span>
</span></span><span class="line"><span class="cl">        <span class="n">val</span> <span class="o">=</span> <span class="n">b0</span> <span class="o">|</span> <span class="p">(</span><span class="n">b1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">b2</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">b3</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">block</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">block</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">check_key</span><span class="p">(</span><span class="n">key37</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    æª¢æŸ¥ key æ˜¯å¦æ»¿è¶³ sub_1400013A0 -&gt; sub_1400012E0
</span></span></span><span class="line"><span class="cl"><span class="s2">    1) Destination = key (37 bytes) + [3,3,3]
</span></span></span><span class="line"><span class="cl"><span class="s2">    2) compute Block
</span></span></span><span class="line"><span class="cl"><span class="s2">    3) check Block == V3U
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">key37</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">37</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="n">dest</span> <span class="o">=</span> <span class="n">key37</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">block</span> <span class="o">=</span> <span class="n">compute_block_from_destination</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">block</span> <span class="o">==</span> <span class="n">V3U</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ---- ä¸»æµç¨‹ï¼šé‚„åŸ Destinationã€å–å¾— keyï¼ˆå‰ 37 bytesï¼‰ã€ä¸¦æ¨¡æ“¬ sub_140001000 å¾—åˆ° flag ----</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">dest40</span> <span class="o">=</span> <span class="n">reconstruct_destination_from_v3</span><span class="p">(</span><span class="n">V3U</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Destination (hex):&#34;</span><span class="p">,</span> <span class="n">dest40</span><span class="o">.</span><span class="n">hex</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">key37</span> <span class="o">=</span> <span class="n">dest40</span><span class="p">[:</span><span class="mi">37</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">tail</span> <span class="o">=</span> <span class="n">dest40</span><span class="p">[</span><span class="mi">37</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Key (37 bytes):&#34;</span><span class="p">,</span> <span class="n">key37</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Tail bytes (should be three 0x03):&#34;</span><span class="p">,</span> <span class="n">tail</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;check_key(key)? -&gt;&#34;</span><span class="p">,</span> <span class="n">check_key</span><span class="p">(</span><span class="n">key37</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">out</span> <span class="o">=</span> <span class="n">sub_140001000_simulate</span><span class="p">(</span><span class="n">key37</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;sub_140001000 output:&#34;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">()</span>
</span></span></code></pre></div></details>
<p>output :</p>
<pre tabindex="0"><code>Destination (hex): 36676724484041567a366774486b462155367a765635593d2d67377a55372e256443512154030303
Key (37 bytes): 6gg$H@AVz6gtHkF!U6zvV5Y=-g7zU7.%dCQ!T
Tail bytes (should be three 0x03): b&#39;\x03\x03\x03&#39;
check_key(key)? -&gt; True
sub_140001000 output: is1abCTF{C0ngrA7ulat10n_Y0U_cR4cK_M3}
</code></pre><div class="flag-box">
<strong>
flag : is1abCTF{C0ngrA7ulat10n_Y0U_cR4cK_M3}
</strong>
</div>
<h3 id="half-baked-image-format">Half-Baked Image Format</h3>
<p><img src="../../images/2025_islab_Half-Baked.png" alt="image"></p>
<p>é¡Œç›®çµ¦äº†ä¸€å€‹ <code>flag.muzi</code> å’Œ <code>muzi.py</code></p>
<details close><summary>muzi.py ç¨‹å¼ç¢¼ </summary>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">crc8</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">inp</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">                Welcome to the is1ab Image Program
</span></span></span><span class="line"><span class="cl"><span class="s2">                It can convert images to MUZIs
</span></span></span><span class="line"><span class="cl"><span class="s2">                It will also display MUZIs
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">                [1] Convert Image to MUZI
</span></span></span><span class="line"><span class="cl"><span class="s2">                [2] Display MUZI
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">                &#34;&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">match</span> <span class="n">inp</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="s2">&#34;1&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">start_conv</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#case &#34;2&#34;:</span>
</span></span><span class="line"><span class="cl">            <span class="c1">#display() #TODO: Add</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">            â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
</span></span></span><span class="line"><span class="cl"><span class="s1">            â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£€â£€â£€â£€â£€â£€â£€â£€â£€â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
</span></span></span><span class="line"><span class="cl"><span class="s1">            â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£€â¡€â ‚â â â â â ‚â ‚â ‚â ‚â â â â â â â ‚â „â¡€â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
</span></span></span><span class="line"><span class="cl"><span class="s1">            â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£€â ‚â â â ‚â¡€â£€â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£€â¡€â „â ‚â  â â ‚â¡€â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
</span></span></span><span class="line"><span class="cl"><span class="s1">            â£¿â£¿â£¿â£¿â£¿â£¿â£€â¡€â â ‚â¡€â£€â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£€â „â   â â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
</span></span></span><span class="line"><span class="cl"><span class="s1">            â£¿â£¿â£¿â£¿â£¿â¡€â â ‚â£€â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡€â¡€â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
</span></span></span><span class="line"><span class="cl"><span class="s1">            â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£€â¡€â „â „â „â „â „â „â „â „â¡€â¡€â£€â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
</span></span></span><span class="line"><span class="cl"><span class="s1">            â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡€â ‚â ‚â „â „â „â¡€â¡€â „â „â „â „â ‚â ‚â â â â ‚â „â£€â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
</span></span></span><span class="line"><span class="cl"><span class="s1">            â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â „â „â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡€â „â ‚â â â „â£€â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
</span></span></span><span class="line"><span class="cl"><span class="s1">            â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£€â „ â â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
</span></span></span><span class="line"><span class="cl"><span class="s1">            â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
</span></span></span><span class="line"><span class="cl"><span class="s1">            â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡€â ‚â ‚â ‚â ‚â ‚â ‚â ‚â „â¡€â£€â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
</span></span></span><span class="line"><span class="cl"><span class="s1">            â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡€â â ‚â¡€â¡€â¡€â¡€â¡€â¡€â „â „â   â ‚â£€â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
</span></span></span><span class="line"><span class="cl"><span class="s1">            â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â „â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡€â  â „â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
</span></span></span><span class="line"><span class="cl"><span class="s1">            â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£€â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
</span></span></span><span class="line"><span class="cl"><span class="s1">            â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
</span></span></span><span class="line"><span class="cl"><span class="s1">            â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â¡€â â „â¡€â£€â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
</span></span></span><span class="line"><span class="cl"><span class="s1">            â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£€â „â ‚â â â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
</span></span></span><span class="line"><span class="cl"><span class="s1">            â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
</span></span></span><span class="line"><span class="cl"><span class="s1">            â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿â£¿
</span></span></span><span class="line"><span class="cl"><span class="s1">            &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="n">_</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">start_conv</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">file</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;Enter the path to your image you want converted to a MUZI file:</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">out</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;Enter the path youâ€™d like to write the MUZI to:</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">write</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x4D</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x55</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x5A</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x49</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x01</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x02</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">w</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">h</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x57</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x49</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x46</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x49</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">dat</span> <span class="o">=</span> <span class="p">[</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x44</span><span class="s1">&#39;</span><span class="p">,</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x41</span><span class="s1">&#39;</span><span class="p">,</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x54</span><span class="s1">&#39;</span><span class="p">,</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x52</span><span class="s1">&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">dat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">getpixel</span><span class="p">((</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> 
</span></span><span class="line"><span class="cl">        <span class="n">dat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getCheck</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="mi">4</span><span class="p">:]))</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">wa</span> <span class="ow">in</span> <span class="n">dat</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wa</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h</span><span class="p">):</span> 
</span></span><span class="line"><span class="cl">        <span class="n">dat</span> <span class="o">=</span> <span class="p">[</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x44</span><span class="s1">&#39;</span><span class="p">,</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x41</span><span class="s1">&#39;</span><span class="p">,</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x54</span><span class="s1">&#39;</span><span class="p">,</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x47</span><span class="s1">&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">dat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">getpixel</span><span class="p">((</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> 
</span></span><span class="line"><span class="cl">        <span class="n">dat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getCheck</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="mi">4</span><span class="p">:]))</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">wa</span> <span class="ow">in</span> <span class="n">dat</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wa</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h</span><span class="p">):</span> 
</span></span><span class="line"><span class="cl">        <span class="n">dat</span> <span class="o">=</span> <span class="p">[</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x44</span><span class="s1">&#39;</span><span class="p">,</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x41</span><span class="s1">&#39;</span><span class="p">,</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x54</span><span class="s1">&#39;</span><span class="p">,</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x42</span><span class="s1">&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">dat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">getpixel</span><span class="p">((</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">))[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">dat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getCheck</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="mi">4</span><span class="p">:]))</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">wa</span> <span class="ow">in</span> <span class="n">dat</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wa</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x44</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x41</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x54</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">write</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x45</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s2">&#34;ab&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">write</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">getCheck</span><span class="p">(</span><span class="n">datr</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">dat</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">datr</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">dat</span><span class="o">+=</span><span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#print(datr)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#print(dat.encode())</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">int</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">crc8</span><span class="o">.</span><span class="n">crc8</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(),</span><span class="n">base</span><span class="o">=</span><span class="mi">16</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">()</span>
</span></span></code></pre></div></details>
<p>åŸºæœ¬ä¸Šå°±åªæ˜¯è½‰æ›åœ–ç‰‡ â†’ MUZI</p>
<p>æ‰€ä»¥è§£é¡Œæ–¹å‘ :</p>
<ol>
<li>å…ˆè®€å– .muzi æª”æ¡ˆçµæ§‹
<ul>
<li>ç¢ºèª header MUZI&hellip;</li>
<li>å–å‡ºå¯¬é«˜</li>
<li>ä¾ç…§ &ldquo;DATR&rdquo;/&ldquo;DATG&rdquo;/&ldquo;DATB&rdquo; å€å¡Šé‡å»º RGB ä¸‰å€‹é€šé“</li>
</ul>
</li>
<li>çµ„åˆå›åœ–ç‰‡
<ul>
<li>æŠŠ Rã€Gã€B ä¸‰å€‹çŸ©é™£æ‹¼æˆ Image.fromarray(np.dstack((R,G,B)))ã€‚</li>
<li>å­˜æˆ .png</li>
</ul>
</li>
</ol>
<p>è…³æœ¬ä¼éµå‡ºå‹•!</p>
<details close><summary>solve.py ç¨‹å¼ç¢¼</summary>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">read_muzi</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&#34;rb&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="n">data</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;MUZI&#34;</span><span class="p">),</span> <span class="s2">&#34;Not a MUZI file&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># è®€å–å¯¬é«˜</span>
</span></span><span class="line"><span class="cl">    <span class="n">w</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">12</span><span class="p">],</span> <span class="s2">&#34;big&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">16</span><span class="p">],</span> <span class="s2">&#34;big&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># æ‰¾åˆ° &#34;WIFI&#34; å¾Œé–‹å§‹</span>
</span></span><span class="line"><span class="cl">    <span class="n">offset</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;WIFI&#34;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl">    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">read_channel</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">arr</span><span class="p">,</span> <span class="n">off</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="n">off</span><span class="p">:</span><span class="n">off</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="n">tag</span>
</span></span><span class="line"><span class="cl">            <span class="n">off</span> <span class="o">+=</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl">            <span class="n">row</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">off</span><span class="p">:</span><span class="n">off</span><span class="o">+</span><span class="n">w</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">off</span> <span class="o">+=</span> <span class="n">w</span>
</span></span><span class="line"><span class="cl">            <span class="n">crc</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">off</span><span class="p">]</span>  <span class="c1"># æ ¡é©—ç¢¼</span>
</span></span><span class="line"><span class="cl">            <span class="n">off</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">            <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">off</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">offset</span> <span class="o">=</span> <span class="n">read_channel</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;DATR&#34;</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">offset</span> <span class="o">=</span> <span class="n">read_channel</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;DATG&#34;</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">offset</span> <span class="o">=</span> <span class="n">read_channel</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;DATB&#34;</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">R</span><span class="p">,</span><span class="n">G</span><span class="p">,</span><span class="n">B</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">img</span> <span class="o">=</span> <span class="n">read_muzi</span><span class="p">(</span><span class="s2">&#34;flag.muzi&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&#34;flag.png&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Saved flag.png&#34;</span><span class="p">)</span>
</span></span></code></pre></div></details>
<p><img src="../../images/flag.png" alt="flag"></p>
<p>å¯å’ªå¯æ„›</p>
<div class="flag-box">
<strong>
flag : is1abCTF{f1le_structur3_r3v3rs1ng_f0r_fun}
</strong>
</div>
<h2 id="web">Web</h2>
<p><strong>å¥½äº†å¥½äº†ï¼ŒWeb ç‹—è¦ä¾†äº†</strong></p>
<h3 id="babyshell">BabyShell</h3>
<p>è¬è¬å®¶ç¶­å­¸é•·çš„æ ½åŸ¹ï¼Œæ²’è¨˜éŒ¯çš„è©±æ‰“å®Œ pico çš„ç¬¬ä¸€é¡Œ Web å°±æ˜¯é€™é¡Œ</p>
<p><a href="https://hackmd.io/@RYe3jksiTgKmlHr5wurLxg/BJJ7rhjEee">BabyShell_Writeup</a></p>
<p>å°æ²’éŒ¯æˆ‘åœ¨æ°´</p>
<h3 id="easysqli">EasySQLi</h3>
<p><img src="../../images/2025_islab_SQLite-login.png" alt="2025_islab_SQLite-login"></p>
<p>é€£ç·šå¾Œæœƒçœ‹åˆ°ç™»å…¥é é¢</p>
<p><img src="../../images/2025_islab_SQLite-login.png" alt="image"></p>
<p>ç›²çŒœå¸³å¯†ç‚º guest/guest</p>
<p>å¾—åˆ°ä¸‹åœ–</p>
<p><img src="../../images/2025_islab_SQLite-fail.png" alt="2025_islab_SQLite-fail"></p>
<p><del>ç¬¬ä¸€æ¬¡çœ‹åˆ°é€™éº¼æ¸…æ¥šæŠŠ Query å¼„å‡ºä¾†çš„ï¼ŒçœŸçš„æ˜¯ easy</del></p>
<p>åœ¨ SQLiteï¼Œæ‰€æœ‰è³‡æ–™è¡¨çµæ§‹è³‡è¨Šéƒ½å­˜æ”¾åœ¨ä¸€å€‹ç‰¹æ®Šçš„ç³»çµ±è¡¨ sqlite_master è£¡ã€‚</p>
<p>sqlite_master è£¡çš„å¸¸ç”¨æ¬„ä½æœ‰ï¼š</p>
<ul>
<li>type â†’ æ˜¯ table / index / view</li>
<li>name â†’ ç‰©ä»¶åç¨±ï¼ˆä¾‹å¦‚è¡¨åï¼‰</li>
<li>sql â†’ å»ºè¡¨èªå¥</li>
</ul>
<p>æ‰€ä»¥æŠŠ name å¡åˆ°å¯è¦‹çš„æ¬„ä½ï¼Œå°±èƒ½åœ¨ username / password / role ä¸‰æ¬„è£¡çœ‹åˆ°æ‰€æœ‰è³‡æ–™è¡¨çš„åç¨±ã€é¡å‹ã€å»ºè¡¨èªæ³•ã€‚</p>
<p>åœ¨å¸³è™Ÿçš„åœ°æ–¹è¼¸å…¥ : <code>' UNION SELECT name, type, sql FROM sqlite_master WHERE type='table' --</code></p>
<p>å¯†ç¢¼éš¨æ„(1234)</p>
<p><code>--</code> çš„ç›®çš„æ˜¯æŠŠå¾Œé¢è¨»è§£æ‰</p>
<p>å¾—åˆ°ä¸‹åœ–</p>
<p><img src="../../images/2025_islab_SQLite-success.png" alt="2025_islab_SQLite-success"></p>
<p>åœ¨ secret è¡¨çœ‹åˆ° flag çš„å­—</p>
<p>ä½†å› ç‚ºæœ‰ä¸‰æ¬„ï¼Œæ‰€ä»¥å…¶ä»–å…©æ¬„ä¹Ÿè¦å¡«ä¸Šå»</p>
<p>å¸³è™Ÿè¼¸å…¥ : <code>' UNION SELECT flag, NULL, NULL FROM secrets --</code></p>
<p>å¯†ç¢¼ä¸€æ¨£ 1234</p>
<p><img src="../../images/2025_islab_SQLite-flag.png" alt="2025_islab_SQLite-flag"></p>
<div class="flag-box">
<strong>
flag : is1abCTF{$UcCE5sFu11y_L34KeD_$EcRET_D@7A}
</strong>
</div>
<p><del>é€™æ‰æ˜¯çœŸçš„ç§’è§£ï¼Œweb2pdf æ‰ä¸æ˜¯55555</del></p>
<h3 id="easy-web2pdf">Easy web2pdf</h3>
<p><img src="../../images/2025_islab_web2pdf.png" alt="2025_islab_web2pdf">
é€™é¡Œç´”ç²¹æ˜¯æˆ‘é¬¼æ‰“ç‰†å¤ªä¹…ï¼Œç¡ä¸€è¦ºéš”å¤©é†’ä¾†å°±è·³å‡ºè‡ªå·±çš„è¿´åœˆäº†</p>
<p>è­‰æ˜ç¡è¦ºçœŸçš„å¾ˆé‡è¦</p>
<p>ç¸½ä¹‹ï¼Œé€£ç·šå¾Œæ‰“é–‹ç¶²é å¦‚åœ–</p>
<p><img src="../../images/2025_islab_web2pdf-file.png" alt="2025_islab_web2pdf-file"></p>
<p>å…ˆçœ‹å¹¾å€‹ä¸»è¦çš„ç¨‹å¼ç¢¼</p>
<details close><summary>server.py ç¨‹å¼ç¢¼</summary>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">redis</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pycurl</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">uuid</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">Response</span><span class="p">,</span> <span class="n">session</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x53\x3b\xce\xf1\x23\x2d\xab\xc2\x11\x23</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/api/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">ping</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">version</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="si">{}</span><span class="s2">.</span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">minor</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">message</span> <span class="o">=</span> <span class="s2">&#34;Flask running on Python </span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">version</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">message</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/api/login&#34;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="s1">&#39;id&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;msg&#39;</span><span class="p">:</span><span class="s1">&#39;Already logged in&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/api/docs&#34;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">manageDocs</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="s1">&#39;id&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;msg&#39;</span><span class="p">:</span><span class="s1">&#39;Invalid session&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">docs</span> <span class="o">=</span> <span class="n">Document</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">newDoc</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">],</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;msg&#39;</span><span class="p">:</span><span class="s1">&#39;OK&#39;</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span><span class="p">:</span><span class="s1">&#39;/api/download?id=&#39;</span> <span class="o">+</span> <span class="n">newDoc</span><span class="o">.</span><span class="n">fileid</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/api/download&#34;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">downloadFile</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">file_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">server</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;server&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#for testing purposes only</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">remote_addr</span> <span class="o">!=</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">server</span> <span class="o">=</span> <span class="s1">&#39;http://127.0.0.1&#39;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">file_id</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">file_id</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">response_buf</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">crl</span> <span class="o">=</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">Curl</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">crl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">crl</span><span class="o">.</span><span class="n">URL</span><span class="p">,</span> <span class="n">server</span> <span class="o">+</span> <span class="s1">&#39;/api/file?filename=&#39;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">crl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">crl</span><span class="o">.</span><span class="n">WRITEDATA</span><span class="p">,</span> <span class="n">response_buf</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">crl</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">crl</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">file_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response_buf</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">file_data</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">resp</span> <span class="o">=</span> <span class="n">Response</span><span class="p">(</span><span class="n">file_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">resp</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;text/html&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">resp</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;msg&#39;</span><span class="p">:</span><span class="s1">&#39;Invalid file id&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># The file storage will soon be migrated to a different server</span>
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/api/file&#34;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">getFile</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">remote_addr</span> <span class="o">!=</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;msg&#39;</span><span class="p">:</span><span class="s1">&#39;Remote access disallowed&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">PDF_DIR</span> <span class="o">=</span> <span class="s1">&#39;/app/web/pdfs/&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">filename</span> <span class="o">=</span> <span class="n">PDF_DIR</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;msg&#39;</span><span class="p">:</span><span class="s1">&#39;ok&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">:</span><span class="n">data</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;msg&#39;</span><span class="p">:</span><span class="s1">&#39;Invalid filename&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;0.0.0.0&#34;</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8001</span><span class="p">)</span>
</span></span></code></pre></div></details>
<details close><summary>model.py ç¨‹å¼ç¢¼</summary> 
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">redis</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">db</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">PDF_PATH</span> <span class="o">=</span> <span class="s1">&#39;/app/web/pdfs/&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Document</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@classmethod</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">sid</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">fileid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">html2pdf</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@classmethod</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">html2pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">PhantomJS</span><span class="p">(</span><span class="n">service_log_path</span><span class="o">=</span><span class="s1">&#39;/dev/null&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">page_source</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">page_source</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">temp_html_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PDF_PATH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileid</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">temp_html_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">page_source</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Error processing </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@classmethod</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sid</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">sid</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">db</span><span class="o">.</span><span class="n">hset</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">db</span><span class="o">.</span><span class="n">expire</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="mi">15</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="c1">#refresh session</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@staticmethod</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="n">sid</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">sid</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">docs</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">hgetall</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">docs</span> <span class="o">=</span> <span class="p">{</span> <span class="n">key</span><span class="o">.</span><span class="n">decode</span><span class="p">():</span> <span class="s1">&#39;/api/download?id=&#39;</span> <span class="o">+</span> <span class="n">val</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">docs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">docs</span>
</span></span></code></pre></div></details>
<details close><summary>readflag.c ç¨‹å¼ç¢¼</summary>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">seteuid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">setegid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">setuid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">setgid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">flag</span><span class="p">[</span><span class="mi">256</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="n">FILE</span><span class="o">*</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&#34;/flag&#34;</span><span class="p">,</span> <span class="s">&#34;r&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">fp</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;fopen&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">fread</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;fread&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">puts</span><span class="p">(</span><span class="n">flag</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div></details>
<details close><summary>Dockerfile ç¨‹å¼ç¢¼(éƒ¨åˆ†)</summary>
<pre tabindex="0"><code class="language-code" data-lang="code"># è™•ç† readflag ç›¸é—œæ–‡ä»¶
COPY readflag.c /readflag.c
RUN echo &#39;flag{fake_flag}&#39; &gt; /flag
RUN chmod 0644 /flag &amp;&amp; chown root:root /flag
RUN chmod 0444 /readflag.c &amp;&amp; gcc /readflag.c -o /readflag
RUN chown root:root /readflag &amp;&amp; chmod 4555 /readflag
</code></pre></details>
<p>ç°¡å–®è¬›ä¸€ä¸‹æµç¨‹ :</p>
<ol>
<li>
<p>ä½¿ç”¨è€…å…ˆå‘ä¼ºæœå™¨ /api/login å–å¾— session idï¼ˆå­˜åœ¨ session ä¸­ï¼‰ã€‚</p>
</li>
<li>
<p>ä½¿ç”¨è€…å‘¼å« /api/docsï¼š</p>
<ol>
<li>GET /api/docsï¼šåˆ—å‡ºè©² session åœ¨ Redis ä¸­å„²å­˜çš„æ–‡ä»¶ï¼ˆDocument.listï¼‰ã€‚</li>
<li>POST /api/docsï¼šæœƒå»ºç«‹ä¸€å€‹ Documentï¼ˆç”± <code>models.py</code> å¯¦ä½œï¼‰ï¼Œå‚³å…¥ url èˆ‡ session idã€‚Document æœƒç”¨ PhantomJS å» <code>driver.get(url)</code> æŠ“å–è©² URL çš„ page_sourceï¼Œç„¶å¾ŒæŠŠçµæœå¯«æˆä¸€å€‹ .pdf æª”ã€‚æœ€å¾ŒæŠŠè©²æª”æ¡ˆ id å­˜åˆ° Redisã€‚</li>
</ol>
</li>
<li>
<p>ä½¿ç”¨è€…å‘ /api/download?id=<fileid> ä¸‹è¼‰è©²æª”æ¡ˆï¼š</p>
<ol>
<li>downloadFile() æœƒæŠŠ file_id è½‰æˆæª”åï¼ˆ&lt;int(file_id)&gt;.pdfï¼‰ï¼Œç„¶å¾Œé€é pycurl å»è«‹æ±‚ server + &lsquo;/api/file?filename=&rsquo; + filenameï¼Œæ‹¿å› JSON ä¸­ file æ¬„ä½çš„ base64 æª”æ¡ˆå…§å®¹ï¼Œè§£ base64 å¾Œå›å‚³çµ¦ä½¿ç”¨è€…ã€‚</li>
<li>è‹¥å‘¼å« /api/download çš„é€£ç·šä¸æ˜¯ä¾†è‡ª 127.0.0.1ï¼ˆä¹Ÿå°±æ˜¯å¤§å¤šæ•¸é ç«¯ä½¿ç”¨è€…ï¼‰ï¼Œç¨‹å¼æœƒæŠŠ server åƒæ•¸å¼·åˆ¶è¨­æˆ http://127.0.0.1ï¼Œä¹Ÿå°±æ˜¯pycurl æœƒå»å‘æœ¬æ©Ÿ (localhost) çš„ /api/file å–å¾—æª”æ¡ˆã€‚</li>
</ol>
</li>
<li>
<p>æœ¬æ©Ÿä¸Šçš„ /api/file è·¯ç”±åªæ¥å—ä¾†è‡ª 127.0.0.1 çš„è«‹æ±‚ï¼ˆ<code>request.remote_addr == '127.0.0.1'</code>ï¼‰
ç„¶å¾Œæœƒç›´æ¥æŠŠ PDF_DIR + filename åš open(&hellip;).read()ï¼Œbase64 å›å‚³ã€‚
ä¹Ÿå°±æ˜¯èªªï¼šä¸€æ—¦ä¼ºæœå™¨å…§éƒ¨å¯ä»¥å­˜åˆ°ä»»æ„æª”æ¡ˆåœ¨ PDF_DIR ä¸‹ï¼Œ<code>/api/download â†’ pycurl localhost:/api/file?filename=... </code>æœƒæŠŠè©²æª”æ¡ˆä»¥ base64 é€é JSON è®€å›ä¸¦æœ€çµ‚å›å‚³çµ¦é ç«¯ä½¿ç”¨è€…ã€‚</p>
</li>
</ol>
<div class="warning-box">
<strong>
å…ˆèªªçµè«– : åªè¦èƒ½è®“ä¼ºæœå™¨è‡ªå·±å»æŠ“å…§éƒ¨è³‡æºï¼Œåœ¨é€éä¼ºæœå™¨æœ¬èº«çš„è®€å–(ä¸‹è¼‰)åŠŸèƒ½ï¼Œå°±å¯ä»¥æŠŠå…§éƒ¨è³‡æ–™æ‹¿èµ°
<p>åŸæœ¬æœ‰ä¸€å€‹æª¢æŸ¥æ©Ÿåˆ¶ : <code>request.remote_addr == '127.0.0.1'</code>ï¼Œåªæœ‰ä¼ºæœå™¨è‡ªå·±æ‰èƒ½ GET /api/file è®€æª”ï¼Œä½†ä¼ºæœå™¨æœƒå»æ‰“é–‹æˆ‘å€‘åœ¨ URL è¼¸å…¥çš„ç¶²å€ï¼ŒæŠŠå…§å®¹å­˜æˆä¸€å€‹æª”æ¡ˆï¼Œæ–¼æ˜¯è®Šæˆ<strong>å…§éƒ¨è³‡æ–™è¢«ä¼ºæœå™¨ç•¶ä½œå¯å°å¤–ç™¼é€çš„æ±è¥¿</strong></p>
<p>ä¹Ÿå°±æ˜¯å¸¸è¦‹çš„ SSRF
</strong></p>
</div>
<p>æ‰€ä»¥åªè¦èƒ½è®“ response è¿”å› <code>{&quot;msg&quot;: &quot;ok&quot;, &quot;file&quot;: data}</code>
data çš„å€¼å°±æ˜¯ flag çš„ base64 çµæœ</p>
<p>åœ¨è§£çš„æ™‚å€™è©¦éå¾ˆå¤šæ²’å¿…è¦çš„æ–¹æ³•ï¼Œåƒæ˜¯ ngrok ä¸Šå‚³ htmlã€file://å”è­°ç­‰ç­‰</p>
<p>ä½†å…¶å¯¦åªè¦è®“ /api/docs çš„ url è‡ªå·±å»è®€åˆ° /flag çš„å€¼ï¼Œé€é /api/download ä¸‹è¼‰é¡¯ç¤ºå°±å¥½</p>
<p>ä¸éå¦‚æœç›´æ¥åœ¨ url çš„åœ°æ–¹è¼¸å…¥
<code>http://127.0.0.1:&lt;port&gt;/api/file?filename=../../../flag</code>
æœƒå‡ºç¾ <code>{&quot;msg&quot;: &quot;Remote access disallowed&quot;}</code></p>
<p>æˆ–æ˜¯ç¶²é ä¸Š URL çš„è¼¸å…¥æ¡† <code>http://127.0.0.1:&lt;port&gt;/api/file?filename=../../../flag</code>
ä¹Ÿåªæœƒè¿”å›ç©ºç™½ç•«é¢</p>
<p>å› ç‚ºä»–çš„è«‹æ±‚æ˜¯ä¾†è‡ªä½ çš„ portï¼Œä¸æ˜¯ <code>127.0.0.1</code>ï¼Œæ‰€ä»¥ /api/download åœ¨æŠ“ filename çš„æ™‚å€™æŠ“ä¸åˆ°æ±è¥¿ï¼Œè‡ªç„¶å°±å›å‚³ç©ºç™½ç•«é¢</p>
<div class="info-box">
<strong>
æœ€çµ‚ payload : `http://127.0.0.1/api/file?filename=../../../flag`
</strong>
</div>
<p>å…©å€‹é‡é»:</p>
<ol>
<li><code>request.remote_addr</code> æ˜¯ä¾†è‡ª <code>127.0.0.1</code></li>
<li><code>server.py</code> ç¨‹å¼ç¢¼çš„ 76ã€77 è¡Œé¡¯ç¤º filename æœƒä¸²æ¥æˆ <code>/app/web/pdfs/</code> + <code>filename</code> çš„åƒæ•¸
æ‰€ä»¥è¦è®“ä»–å›åˆ°æ ¹ç›®éŒ„å»æ‰¾ flag
(æ ¹æ“š <code>readflag.c</code> å¾—çŸ¥ flag åœ¨æ ¹ç›®éŒ„åº•ä¸‹ï¼Œå†æ ¹æ“š <code>Dockerfile</code> çŸ¥é“ flag è¢«å¯«åœ¨ /flag è£¡é¢)</li>
</ol>
<p>åœ¨ç¶²é çš„ URL è¼¸å…¥ payload åœ¨ä¸‹è¼‰å°±å¯ä»¥å¾—åˆ° base64 éçš„ flag äº†</p>
<p><img src="../../images/2025_islab_web2pdf-flag.png" alt="2025_islab_web2pdf-flag"></p>
<div class="flag-box">
<strong>
flag : is1abCTF{a116534c-a570-467b-8c76-c2ea14789c18}
</strong>
</div></article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script type="application/javascript" src='https://lyccyc.github.io/penguin.cyc/js/toc.js'></script>
<link rel="stylesheet" href='https://lyccyc.github.io/penguin.cyc/css/toc.css' />

  
</div>

  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="https://lyccyc.github.io/penguin.cyc/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
      <li class="mr-3 mr-lg-0">GitHub and the Invertocat logo are trademarks of <a href="https://github.com/">GitHub, Inc.</a></li>
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>

</body>

<script type="application/javascript" src="https://lyccyc.github.io/penguin.cyc/js/github-style.js"></script>







</html>